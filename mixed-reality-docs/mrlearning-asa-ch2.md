---
title: Tutoriels Azure Spatial Anchors - 2. Enregistrement, récupération et partage d’ancres spatiales Azure
description: Suivez ce cours pour découvrir comment implémenter la reconnaissance faciale Azure au sein d’une application de réalité mixte.
author: jessemcculloch
ms.author: jemccull
ms.date: 02/26/2019
ms.topic: article
keywords: réalité mixte, unity, tutoriel, hololens
ms.localizationpriority: high
ms.openlocfilehash: 4de40bb0b66ed299fa4a571490b33a0454f25817
ms.sourcegitcommit: 5b2ba01aa2e4a80a3333bfdc850ab213a1b523b9
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/10/2020
ms.locfileid: "79031705"
---
# <a name="2-saving-retrieving-and-sharing-azure-spatial-anchors"></a><span data-ttu-id="fc6c6-105">2. Enregistrement, récupération et partage d’ancres spatiales Azure</span><span class="sxs-lookup"><span data-stu-id="fc6c6-105">2. Saving, retrieving, and sharing Azure Spatial Anchors</span></span>

<span data-ttu-id="fc6c6-106">Dans ce tutoriel, vous allez apprendre à enregistrer des ancres spatiales Azure dans plusieurs sessions d’application en enregistrant l’ID d’ancre dans le stockage de HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-106">In this tutorial, you will learn how to save Azure Spatial Anchors across multiple app sessions by saving the anchor ID to the HoloLens 2's storage.</span></span> <span data-ttu-id="fc6c6-107">Vous allez également apprendre à partager cet ID d’ancre avec d’autres appareils à des fins d’alignement d’ancre sur plusieurs appareils.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-107">You will also learn how to share this anchor ID to other devices for a multi-device anchor alignment.</span></span>

## <a name="objectives"></a><span data-ttu-id="fc6c6-108">Objectifs</span><span class="sxs-lookup"><span data-stu-id="fc6c6-108">Objectives</span></span>

* <span data-ttu-id="fc6c6-109">Découvrir comment enregistrer et récupérer des ID d’ancre spatiale Azure sur le disque local HoloLens 2, à des fins de persistance entre des sessions d’application</span><span class="sxs-lookup"><span data-stu-id="fc6c6-109">Learn how to save and retrieve Azure Spatial Anchor IDs to and from the HoloLens 2 local disk, for persistence between app sessions</span></span>
* <span data-ttu-id="fc6c6-110">Découvrir comment partager des ID d’ancre spatiale Azure entre des utilisateurs dans un scénario à plusieurs appareils</span><span class="sxs-lookup"><span data-stu-id="fc6c6-110">Learn how to share Azure Spatial Anchor IDs between users in a multi-device scenario</span></span>

## <a name="preparing-the-scene"></a><span data-ttu-id="fc6c6-111">Préparation de la scène</span><span class="sxs-lookup"><span data-stu-id="fc6c6-111">Preparing the scene</span></span>

<span data-ttu-id="fc6c6-112">Dans la fenêtre Project, accédez au dossier **Assets** > **MRTK.Tutorials.AzureSpatialAnchors** > **Prefabs**.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-112">In the Project window, navigate to **Assets** > **MRTK.Tutorials.AzureSpatialAnchors** > **Prefabs** folder.</span></span> <span data-ttu-id="fc6c6-113">Tout en maintenant la touche Ctrl enfoncée, cliquez sur **ButtonParent_SaveAnchorId** et **ButtonParent_ShareAnchorId** pour sélectionner les deux préfabriqués, puis faites-les glisser dans la fenêtre Hierarchy pour les ajouter à la scène :</span><span class="sxs-lookup"><span data-stu-id="fc6c6-113">While holding down the CTRL button, click on **ButtonParent_SaveAnchorId** and **ButtonParent_ShareAnchorId** to select the two prefabs, then drag them into the Hierarchy window to add them to the scene:</span></span>

![mrlearning-asa](images/mrlearning-asa/tutorial2-section1-step1-1.png)

## <a name="persist-azure-anchors-between-app-sessions---save-anchor-id-to-disk"></a><span data-ttu-id="fc6c6-115">Conserver les ancres Azure entre les sessions d’application - Enregistrer l’ID d’ancre sur le disque</span><span class="sxs-lookup"><span data-stu-id="fc6c6-115">Persist Azure Anchors between app sessions - Save anchor ID to disk</span></span>
<!-- TODO: Consider renaming to 'Persist Azure Anchors between app sessions' -->

<span data-ttu-id="fc6c6-116">Dans cette section, vous allez apprendre à enregistrer et à récupérer l’ID d’ancre Azure sur le disque local HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-116">In this section, you will learn how to save and retrieve the Azure Anchor ID to and from the HoloLens 2 local disk.</span></span> <span data-ttu-id="fc6c6-117">Vous pouvez alors demander à Azure le même ID d’ancre entre différentes sessions d’application, ce qui permet aux hologrammes ancrés d’être positionnés au même endroit que dans la session d’application précédente.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-117">This will allow you to query Azure for the same anchor ID between different app sessions, allowing the anchored holograms to be position at the same location as in the previous app session.</span></span>

<span data-ttu-id="fc6c6-118">Dans la fenêtre Hierarchy, développez l’objet **ButtonParent_SaveAnchorId** qui contient deux boutons, un pour enregistrer l’ID d’ancre Azure dans le stockage HoloLens 2 et un pour récupérer l’ID enregistré sur le disque :</span><span class="sxs-lookup"><span data-stu-id="fc6c6-118">In the Hierarchy window, expand the **ButtonParent_SaveAnchorId** object which contains two buttons, one button for saving the Azure Anchor ID to the HoloLens 2 storage and another for retrieving the saved ID from the disk:</span></span>

![mrlearning-asa](images/mrlearning-asa/tutorial2-section2-step1-1.png)

<span data-ttu-id="fc6c6-120">Suivez les mêmes étapes que celles indiquées dans [Configuration des boutons pour faire fonctionner la scène](mrlearning-asa-ch1.md#configuring-the-buttons-to-operate-the-scene) dans le tutoriel précédent pour configurer le composant **Pressable Button Holo Lens 2 (Script)** et le composant **Interactable (Script)** sur chacun des deux boutons :</span><span class="sxs-lookup"><span data-stu-id="fc6c6-120">Follow the same steps as in the [configuring the buttons to operate the scene](mrlearning-asa-ch1.md#configuring-the-buttons-to-operate-the-scene) instructions from the previous tutorial to configure the **Pressable Button Holo Lens 2 (Script)** component and the **Interactable (Script)** component on each of the two buttons:</span></span>

* <span data-ttu-id="fc6c6-121">Pour l’objet **SaveAzureAnchorIdToDisk**, affectez la fonction AnchorModuleScript > **SaveAzureAnchorIdToDisk ()** .</span><span class="sxs-lookup"><span data-stu-id="fc6c6-121">For the **SaveAzureAnchorIdToDisk** object, assign the AnchorModuleScript > **SaveAzureAnchorIdToDisk ()** function.</span></span>
* <span data-ttu-id="fc6c6-122">Pour l’objet **GetAzureAnchorIdFromDisk**, affectez la fonction AnchorModuleScript > **GetAzureAnchorIdFromDisk ()** .</span><span class="sxs-lookup"><span data-stu-id="fc6c6-122">For the **GetAzureAnchorIdFromDisk** object, assign the AnchorModuleScript > **GetAzureAnchorIdFromDisk ()** function.</span></span>

<span data-ttu-id="fc6c6-123">Si vous générez l’application mise à jour dans votre HoloLens, vous pouvez à présent conserver les ancres spatiales Azure entre les sessions d’application en enregistrant l’ID d’ancre Azure.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-123">If you build the updated application to your HoloLens, you can now persist Azure Spatial Anchors between app sessions by saving the Azure Anchor ID.</span></span> <span data-ttu-id="fc6c6-124">Pour le tester, vous pouvez effectuer ces étapes :</span><span class="sxs-lookup"><span data-stu-id="fc6c6-124">To test it out, you can follow these steps:</span></span>

1. <span data-ttu-id="fc6c6-125">Déplacez l’expérience Rocket Launcher à l’endroit souhaité.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-125">Move the Rocket Launcher experience to desired location.</span></span>
2. <span data-ttu-id="fc6c6-126">Démarrez la session Azure.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-126">Start Azure Session.</span></span>
3. <span data-ttu-id="fc6c6-127">Créez une ancre Azure (cela crée des ancres à l’emplacement de l’expérience Rocket Launcher).</span><span class="sxs-lookup"><span data-stu-id="fc6c6-127">Create Azure Anchor (creates anchors at the location of the Rocket Launcher experience).</span></span>
4. <span data-ttu-id="fc6c6-128">Enregistrez l’ID d’ancre Azure sur le disque.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-128">Save Azure Anchor ID to Disk.</span></span>
5. <span data-ttu-id="fc6c6-129">Redémarrez l’application.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-129">Restart the application.</span></span>
6. <span data-ttu-id="fc6c6-130">Obtenez l’ancre Azure à partir du disque (cela charge l’ID d’ancre que vous venez d’enregistrer).</span><span class="sxs-lookup"><span data-stu-id="fc6c6-130">Get Azure Anchor from Disk (loads the anchor ID you just saved).</span></span>
7. <span data-ttu-id="fc6c6-131">Démarrez la session Azure.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-131">Start Azure Session.</span></span>
8. <span data-ttu-id="fc6c6-132">Recherchez l’ancre Azure (cela positionne l’expérience Rocket Launcher à l’emplacement de l’étape 3).</span><span class="sxs-lookup"><span data-stu-id="fc6c6-132">Find Azure Anchor (positions the Rocket Launcher experience at the location from step 3).</span></span>

## <a name="share-azure-anchors-between-multiple-devices"></a><span data-ttu-id="fc6c6-133">Partager des ancres Azure entre plusieurs appareils</span><span class="sxs-lookup"><span data-stu-id="fc6c6-133">Share Azure Anchors between multiple devices</span></span>

<span data-ttu-id="fc6c6-134">Dans cette section, vous allez apprendre à partager l’ID d’ancre Azure entre plusieurs appareils.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-134">In this section, you will learn how to share the Azure Anchor ID between multiple devices.</span></span> <span data-ttu-id="fc6c6-135">Ainsi, plusieurs appareils peuvent demander à Azure le même ID d’ancre, ce qui permet d’aligner dans l’espace des hologrammes ancrés.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-135">This will allow multiple devices to query Azure for the same anchor ID, allowing the anchored holograms to be spatially aligned.</span></span> <span data-ttu-id="fc6c6-136">L’alignement spatial, c’est-à-dire le fait de voir les mêmes hologrammes au même emplacement physique entre plusieurs appareils, est primordial pour les expériences partagées locales dans le HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-136">Spatial alignment, i.e. seeing the same holograms in the same physical location between multiple devices, is key to local shared experiences in the HoloLens 2.</span></span>

<span data-ttu-id="fc6c6-137">Il existe de nombreuses façons de transférer des ID d’ancre Azure entre des appareils, notamment les méthodes décrites dans la série de [tutoriels sur les fonctionnalités multi-utilisateurs](mrlearning-sharing(photon)-ch1.md).</span><span class="sxs-lookup"><span data-stu-id="fc6c6-137">There are many ways to transfer Azure Anchor IDs between devices, including methods outlined in the the [Multi-user capabilities tutorials](mrlearning-sharing(photon)-ch1.md) series.</span></span> <span data-ttu-id="fc6c6-138">Dans cet exemple, vous allez utiliser un service web simple pour charger et télécharger des ID d’ancre entre des appareils.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-138">In this example, you will use a simple web service to upload and download anchor IDs between devices.</span></span>

<span data-ttu-id="fc6c6-139">Dans la fenêtre Hierarchy, développez l’objet **ButtonParent_ShareAnchorId** qui contient deux boutons, un bouton pour charger l’ID d’ancre Azure sur le serveur web et un autre pour télécharger l’ID à partir du serveur web :</span><span class="sxs-lookup"><span data-stu-id="fc6c6-139">In the Hierarchy window, expand the **ButtonParent_ShareAnchorId** object which contains two buttons; one button for uploading the Azure Anchor ID to the web server, and another for downloading the ID from the web server:</span></span>

![mrlearning-asa](images/mrlearning-asa/tutorial2-section3-step1-1.png)

<span data-ttu-id="fc6c6-141">Suivez les mêmes étapes que celles indiquées dans [Configuration des boutons pour faire fonctionner la scène](mrlearning-asa-ch1.md#configuring-the-buttons-to-operate-the-scene) dans le tutoriel précédent pour configurer le composant **Pressable Button Holo Lens 2 (Script)** et le composant **Interactable (Script)** sur chacun des deux boutons :</span><span class="sxs-lookup"><span data-stu-id="fc6c6-141">Follow the same steps as in the [configuring the buttons to operate the scene](mrlearning-asa-ch1.md#configuring-the-buttons-to-operate-the-scene) instructions from the previous tutorial to configure the **Pressable Button Holo Lens 2 (Script)** component and the **Interactable (Script)** component on each of the two buttons:</span></span>

* <span data-ttu-id="fc6c6-142">Pour l’objet **ShareAzureAnchorIdToNetwork**, affectez la fonction AnchorModuleScript > **ShareAzureAnchorIdToNetwork ()** .</span><span class="sxs-lookup"><span data-stu-id="fc6c6-142">For the **ShareAzureAnchorIdToNetwork** object, assign the AnchorModuleScript > **ShareAzureAnchorIdToNetwork ()** function.</span></span>
* <span data-ttu-id="fc6c6-143">Pour l’objet **GetAzureAnchorIdFromNetwork**, affectez la fonction AnchorModuleScript > **GetAzureAnchorIdFromNetwork ()** .</span><span class="sxs-lookup"><span data-stu-id="fc6c6-143">For the **GetAzureAnchorIdFromNetwork** object, assign the AnchorModuleScript > **GetAzureAnchorIdFromNetwork ()** function.</span></span>

<span data-ttu-id="fc6c6-144">Si vous générez l’application mise à jour sur deux appareils HoloLens, vous pouvez à présent obtenir un alignement spatial entre eux en partageant l’ID d’ancre Azure.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-144">If you build the updated application to two HoloLens devices, you can now achieve spatial alignment between them by sharing the Azure Anchor ID.</span></span> <span data-ttu-id="fc6c6-145">Pour le tester, vous pouvez effectuer ces étapes :</span><span class="sxs-lookup"><span data-stu-id="fc6c6-145">To test it out, you can follow these steps:</span></span>

1. <span data-ttu-id="fc6c6-146">Sur l’appareil HoloLens 1 : Déplacez l’expérience Rocket Launcher à l’endroit souhaité.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-146">On HoloLens device 1: Move the Rocket Launcher experience to desired location.</span></span>
2. <span data-ttu-id="fc6c6-147">Sur l’appareil HoloLens 1 : Démarrez la session Azure.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-147">On HoloLens device 1: Start Azure Session.</span></span>
3. <span data-ttu-id="fc6c6-148">Sur l’appareil HoloLens 1 : Créez une ancre Azure (cela crée des ancres à l’emplacement de l’expérience Rocket Launcher).</span><span class="sxs-lookup"><span data-stu-id="fc6c6-148">On HoloLens device 1: Create Azure Anchor (creates anchors at the location of the Rocket Launcher experience).</span></span>
4. <span data-ttu-id="fc6c6-149">Sur l’appareil HoloLens 1 : Partagez l’ID d’ancre Azure sur le réseau.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-149">On HoloLens device 1: Share Azure Anchor ID to Network.</span></span>
5. <span data-ttu-id="fc6c6-150">Sur l’appareil HoloLens 2 : Redémarrez l’application.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-150">On HoloLens device 2: Restart the application.</span></span>
6. <span data-ttu-id="fc6c6-151">Sur l’appareil HoloLens 2 : Obtenez l’ID d’ancre partagé à partir du réseau (cela extrait l’ID d’ancre qui vient d’être partagé de l’appareil HoloLens 1).</span><span class="sxs-lookup"><span data-stu-id="fc6c6-151">On HoloLens device 2: Get Shared Anchor ID from Network (fetches the anchor ID just shared from HoloLens device 1).</span></span>
7. <span data-ttu-id="fc6c6-152">Sur l’appareil HoloLens 2 : Démarrez la session Azure.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-152">On HoloLens device 2: Start Azure Session.</span></span>
8. <span data-ttu-id="fc6c6-153">Sur l’appareil HoloLens 2 : Recherchez l’ancre Azure (cela positionne l’expérience Rocket Launcher à l’emplacement de l’étape 3).</span><span class="sxs-lookup"><span data-stu-id="fc6c6-153">On HoloLens device 2: Find Azure Anchor (positions the Rocket Launcher experience at the location from step 3).</span></span>

> [!TIP]
> <span data-ttu-id="fc6c6-154">Si vous ne disposez que d’un HoloLens, vous pouvez quand même tester la fonctionnalité en redémarrant l’application au lieu d’utiliser un second appareil HoloLens.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-154">If you only have one HoloLens, you can still test the functionality by restarting the application instead of using a second HoloLens device.</span></span>

## <a name="congratulations"></a><span data-ttu-id="fc6c6-155">Félicitations</span><span class="sxs-lookup"><span data-stu-id="fc6c6-155">Congratulations</span></span>

<span data-ttu-id="fc6c6-156">Dans ce tutoriel, vous avez appris à conserver des ancres spatiales Azure entre les sessions d’application et les redémarrages d’application en enregistrant l’ID d’ancre spatiale Azure sur le disque local sur HoloLens.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-156">In this tutorial you learned how to persist Azure Spatial Anchors between application sessions and application restarts by saving the Azure Spatial Anchor ID to the local disk on HoloLens.</span></span> <span data-ttu-id="fc6c6-157">Vous avez également appris à partager des ancres spatiales Azure entre plusieurs appareils pour une expérience partagée d’hologramme statique multi-utilisateur de base.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-157">You also learned how to share Azure Spatial Anchors between multiple devices for a basic multi-user, static hologram shared experience.</span></span>

<span data-ttu-id="fc6c6-158">Dans le tutoriel suivant, vous allez apprendre à offrir aux utilisateurs un retour en temps réel.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-158">In the next tutorial you will learn how to provide users with real-time feedback.</span></span> <span data-ttu-id="fc6c6-159">Ce retour inclut des informations sur la création d’ancres, la compréhension de qualité de l’environnement et l’état de la session Azure.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-159">This feedback will include information about Anchor creation, the quality of environment understanding, and the state of the Azure session.</span></span> <span data-ttu-id="fc6c6-160">Sans retour, les utilisateurs risquent de ne pas savoir si une ancre a été correctement chargée sur Azure, si la qualité de l’environnement est suffisante pour créer une ancre ou pour l’état actuel.</span><span class="sxs-lookup"><span data-stu-id="fc6c6-160">Without feedback, users may not know whether an anchor has successfully been uploaded to Azure, whether the quality of the environment is sufficient for anchor creation, or the current state.</span></span>

[<span data-ttu-id="fc6c6-161">Leçon suivante : 3. Affichage des commentaires sur les ancres spatiales Azure</span><span class="sxs-lookup"><span data-stu-id="fc6c6-161">Next Lesson: 3. Displaying Azure Spatial Anchor feedback</span></span>](mrlearning-asa-ch3.md)
