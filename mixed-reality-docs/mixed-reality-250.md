---
title: RM partageant 250-HoloLens et des casques immersifs
description: Suivez cette procédure pas à pas de codage à l’aide des casques Unity, Visual Studio, HoloLens et Windows Mixed Reality pour apprendre les détails du partage d’hologrammes entre des appareils de réalité mixte.
author: keveleigh
ms.author: kurtie
ms.date: 03/21/2018
ms.topic: article
keywords: holotoolkit, mixedrealitytoolkit, mixedrealitytoolkit-Unity, immersion, contrôleur de mouvement, partage, contrôleur Xbox, mise en réseau, inter-appareils
ms.openlocfilehash: 9e1cb0d168b8bf830b4477190516cd19caef7972
ms.sourcegitcommit: 915d3cc63a5571ba22ac4608589f3eca8da1bc81
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/24/2019
ms.locfileid: "63506113"
---
>[!NOTE]
><span data-ttu-id="8412d-104">Les didacticiels d’Académie de la réalité mixte ont été conçus avec les casques immersif (1er génération) et de réalité mixte à l’esprit.</span><span class="sxs-lookup"><span data-stu-id="8412d-104">The Mixed Reality Academy tutorials were designed with HoloLens (1st gen) and Mixed Reality Immersive Headsets in mind.</span></span>  <span data-ttu-id="8412d-105">Par conséquent, nous pensons qu’il est important de ne pas mettre en place ces didacticiels pour les développeurs qui cherchent toujours des conseils en matière de développement pour ces appareils.</span><span class="sxs-lookup"><span data-stu-id="8412d-105">As such, we feel it is important to leave these tutorials in place for developers who are still looking for guidance in developing for those devices.</span></span>  <span data-ttu-id="8412d-106">Ces didacticiels ne seront **_pas_** mis à jour avec les derniers ensembles d’outils ou interactions utilisés pour HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="8412d-106">These tutorials will **_not_** be updated with the latest toolsets or interactions being used for HoloLens 2.</span></span>  <span data-ttu-id="8412d-107">Ils seront conservés pour continuer à travailler sur les appareils pris en charge.</span><span class="sxs-lookup"><span data-stu-id="8412d-107">They will be maintained to continue working on the supported devices.</span></span> <span data-ttu-id="8412d-108">Une nouvelle série de didacticiels sera publiée à l’avenir qui vous montrera comment développer pour HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="8412d-108">There will be a new series of tutorials that will be posted in the future that will demonstrate how to develop for HoloLens 2.</span></span>  <span data-ttu-id="8412d-109">Cet avis sera mis à jour avec un lien vers ces didacticiels lors de leur publication.</span><span class="sxs-lookup"><span data-stu-id="8412d-109">This notice will be updated with a link to those tutorials when they are posted.</span></span>

<br>

# <a name="mr-sharing-250-hololens-and-immersive-headsets"></a><span data-ttu-id="8412d-110">RM partageant 250: HoloLens et casques immersifs</span><span class="sxs-lookup"><span data-stu-id="8412d-110">MR Sharing 250: HoloLens and immersive headsets</span></span>

<span data-ttu-id="8412d-111">Avec la flexibilité de plateforme Windows universelle (UWP), il est facile de créer une application qui s’étend sur plusieurs appareils.</span><span class="sxs-lookup"><span data-stu-id="8412d-111">With the flexibility of Universal Windows Platform (UWP), it is easy to create an application that spans multiple devices.</span></span> <span data-ttu-id="8412d-112">Grâce à cette flexibilité, nous pouvons créer des expériences qui tirent parti des avantages de chaque appareil.</span><span class="sxs-lookup"><span data-stu-id="8412d-112">With this flexibility, we can create experiences that leverage the strengths of each device.</span></span> <span data-ttu-id="8412d-113">Ce didacticiel couvre une expérience partagée de base qui s’exécute à la fois sur HoloLens et sur les casques immersifs de la réalité mixte Windows.</span><span class="sxs-lookup"><span data-stu-id="8412d-113">This tutorial will cover a basic shared experience that runs on both HoloLens and Windows Mixed Reality immersive headsets.</span></span> <span data-ttu-id="8412d-114">Ce contenu a été fourni à l’origine lors de la Conférence Microsoft Build 2017 à Seattle, WA.</span><span class="sxs-lookup"><span data-stu-id="8412d-114">This content was originally delivered at the Microsoft Build 2017 conference in Seattle, WA.</span></span>

<span data-ttu-id="8412d-115">**Dans ce didacticiel, nous allons:**</span><span class="sxs-lookup"><span data-stu-id="8412d-115">**In this tutorial, we will:**</span></span>

* <span data-ttu-id="8412d-116">Configurer un réseau à l’aide de UNET.</span><span class="sxs-lookup"><span data-stu-id="8412d-116">Setup a network using UNET.</span></span>
* <span data-ttu-id="8412d-117">Partager des hologrammes sur des appareils de réalité mixte.</span><span class="sxs-lookup"><span data-stu-id="8412d-117">Share holograms across mixed reality devices.</span></span>
* <span data-ttu-id="8412d-118">Établissez une vue différente de l’application en fonction de l’appareil de réalité mixte utilisé.</span><span class="sxs-lookup"><span data-stu-id="8412d-118">Establish a different view of the application depending on which mixed reality device is being used.</span></span>
* <span data-ttu-id="8412d-119">Créez une expérience partagée dans laquelle les utilisateurs de HoloLens guident les utilisateurs immersifs à travers des puzzles simples.</span><span class="sxs-lookup"><span data-stu-id="8412d-119">Create a shared experience where HoloLens users guide immersive headsets users through some simple puzzles.</span></span>

## <a name="device-support"></a><span data-ttu-id="8412d-120">Prise en charge des appareils</span><span class="sxs-lookup"><span data-stu-id="8412d-120">Device support</span></span>

<table>
<tr>
<th><span data-ttu-id="8412d-121">Course</span><span class="sxs-lookup"><span data-stu-id="8412d-121">Course</span></span></th><th style="width:150px"> <span data-ttu-id="8412d-122"><a href="hololens-hardware-details.md">HoloLens</a></span><span class="sxs-lookup"><span data-stu-id="8412d-122"><a href="hololens-hardware-details.md">HoloLens</a></span></span></th><th style="width:150px"> <span data-ttu-id="8412d-123"><a href="immersive-headset-hardware-details.md">Casques immersifs</a></span><span class="sxs-lookup"><span data-stu-id="8412d-123"><a href="immersive-headset-hardware-details.md">Immersive headsets</a></span></span></th>
</tr><tr>
<td><span data-ttu-id="8412d-124">RM partageant 250: HoloLens et casques immersifs</span><span class="sxs-lookup"><span data-stu-id="8412d-124">MR Sharing 250: HoloLens and immersive headsets</span></span></td><td style="text-align: center;"> <span data-ttu-id="8412d-125">✔️</span><span class="sxs-lookup"><span data-stu-id="8412d-125">✔️</span></span></td><td style="text-align: center;"> <span data-ttu-id="8412d-126">✔️</span><span class="sxs-lookup"><span data-stu-id="8412d-126">✔️</span></span></td>
</tr>
</table>

## <a name="before-you-start"></a><span data-ttu-id="8412d-127">Avant de commencer</span><span class="sxs-lookup"><span data-stu-id="8412d-127">Before you start</span></span>

### <a name="prerequisites"></a><span data-ttu-id="8412d-128">Prérequis</span><span class="sxs-lookup"><span data-stu-id="8412d-128">Prerequisites</span></span>

* <span data-ttu-id="8412d-129">Un PC Windows 10 avec les [outils de développement nécessaires](install-the-tools.md) et [configuré pour prendre en charge un casque immersif Windows Mixed Reality](https://docs.microsoft.com/windows/mixed-reality/enthusiast-guide/windows-mixed-reality-minimum-pc-hardware-compatibility-guidelines).</span><span class="sxs-lookup"><span data-stu-id="8412d-129">A Windows 10 PC with the [necessary development tools](install-the-tools.md) and [configured to support a Windows Mixed Reality immersive headset](https://docs.microsoft.com/windows/mixed-reality/enthusiast-guide/windows-mixed-reality-minimum-pc-hardware-compatibility-guidelines).</span></span>
* <span data-ttu-id="8412d-130">Un contrôleur Xbox qui fonctionne avec votre PC.</span><span class="sxs-lookup"><span data-stu-id="8412d-130">An Xbox controller that works with your PC.</span></span>
* <span data-ttu-id="8412d-131">Au moins un appareil HoloLens et un casque immersif.</span><span class="sxs-lookup"><span data-stu-id="8412d-131">At least one HoloLens device and one immersive headset.</span></span>
* <span data-ttu-id="8412d-132">Réseau qui autorise la diffusion UDP pour la découverte.</span><span class="sxs-lookup"><span data-stu-id="8412d-132">A network which allows UDP Broadcast for discovery.</span></span>

### <a name="project-files"></a><span data-ttu-id="8412d-133">Fichiers projet</span><span class="sxs-lookup"><span data-stu-id="8412d-133">Project files</span></span>

* <span data-ttu-id="8412d-134">Téléchargez les [fichiers](https://github.com/Microsoft/MixedReality250/archive/master.zip) requis par le projet.</span><span class="sxs-lookup"><span data-stu-id="8412d-134">Download the [files](https://github.com/Microsoft/MixedReality250/archive/master.zip) required by the project.</span></span> <span data-ttu-id="8412d-135">Extrayez les fichiers à un emplacement facile à mémoriser.</span><span class="sxs-lookup"><span data-stu-id="8412d-135">Extract the files to an easy to remember location.</span></span>
* <span data-ttu-id="8412d-136">Ce projet nécessite la [version d’Unity recommandée avec prise en charge de Windows Mixed Reality](install-the-tools.md).</span><span class="sxs-lookup"><span data-stu-id="8412d-136">This project requires the [a recommended version of Unity with Windows Mixed Reality support](install-the-tools.md).</span></span>

>[!NOTE]
><span data-ttu-id="8412d-137">Si vous souhaitez examiner le code source avant le téléchargement, il est [disponible sur GitHub](https://github.com/Microsoft/MixedReality250).</span><span class="sxs-lookup"><span data-stu-id="8412d-137">If you want to look through the source code before downloading, it's [available on GitHub](https://github.com/Microsoft/MixedReality250).</span></span>

## <a name="chapter-1---holo-world"></a><span data-ttu-id="8412d-138">Chapitre 1-Holo World</span><span class="sxs-lookup"><span data-stu-id="8412d-138">Chapter 1 - Holo World</span></span>

>[!VIDEO https://www.youtube.com/embed/IC0rp6rLiEc]

### <a name="objectives"></a><span data-ttu-id="8412d-139">Objectifs</span><span class="sxs-lookup"><span data-stu-id="8412d-139">Objectives</span></span>

<span data-ttu-id="8412d-140">Assurez-vous que l’environnement de développement est prêt à l’emploi avec un projet simple.</span><span class="sxs-lookup"><span data-stu-id="8412d-140">Make sure the development environment is ready to go with a simple project.</span></span>

### <a name="what-we-will-build"></a><span data-ttu-id="8412d-141">Ce que nous allons créer</span><span class="sxs-lookup"><span data-stu-id="8412d-141">What we will build</span></span>

<span data-ttu-id="8412d-142">Application qui affiche un hologramme sur HoloLens ou sur un casque immersif Windows Mixed Reality.</span><span class="sxs-lookup"><span data-stu-id="8412d-142">An application that shows a hologram on either HoloLens or a Windows Mixed Reality immersive headset.</span></span>

### <a name="steps"></a><span data-ttu-id="8412d-143">Étapes</span><span class="sxs-lookup"><span data-stu-id="8412d-143">Steps</span></span>
* <span data-ttu-id="8412d-144">Ouvrez Unity.</span><span class="sxs-lookup"><span data-stu-id="8412d-144">Open Unity.</span></span>
    * <span data-ttu-id="8412d-145">Sélectionnez **ouvrir**.</span><span class="sxs-lookup"><span data-stu-id="8412d-145">Select **Open**.</span></span>
    * <span data-ttu-id="8412d-146">Accédez à l’emplacement où vous avez extrait les fichiers projet.</span><span class="sxs-lookup"><span data-stu-id="8412d-146">Navigate to where you extracted the project files.</span></span>
    * <span data-ttu-id="8412d-147">Cliquez sur **Sélectionner un dossier**.</span><span class="sxs-lookup"><span data-stu-id="8412d-147">Click **Select Folder**.</span></span>
    * <span data-ttu-id="8412d-148">*Il faut un peu pour Unity pour traiter le projet la première fois.*</span><span class="sxs-lookup"><span data-stu-id="8412d-148">*It will take a little while for Unity to process the project the first time.*</span></span>
* <span data-ttu-id="8412d-149">Vérifiez que la réalité mixte est activée dans Unity.</span><span class="sxs-lookup"><span data-stu-id="8412d-149">Check that Mixed Reality is enabled in Unity.</span></span>
    * <span data-ttu-id="8412d-150">Ouvrez la boîte de dialogue Paramètres de build (**Ctrl + Maj + B** ou **fichier > paramètres de Build...** ).</span><span class="sxs-lookup"><span data-stu-id="8412d-150">Open the build settings dialog (**Control+Shift+B** or **File > Build Settings...**).</span></span>
    * <span data-ttu-id="8412d-151">Sélectionnez **plateforme Windows universelle** puis cliquez sur **changer de plateforme**.</span><span class="sxs-lookup"><span data-stu-id="8412d-151">Select **Universal Windows Platform** then click **Switch Platform**.</span></span>
    * <span data-ttu-id="8412d-152">Sélectionnez **modifier les paramètres du lecteur >** .</span><span class="sxs-lookup"><span data-stu-id="8412d-152">Select **Edit>Player Settings**.</span></span>
    * <span data-ttu-id="8412d-153">Dans le volet de l' **inspecteur** situé sur le côté droit, développez **paramètres XR**.</span><span class="sxs-lookup"><span data-stu-id="8412d-153">In the **Inspector** panel on the right hand side, expand **XR Settings**.</span></span>
    * <span data-ttu-id="8412d-154">Cochez la case la **réalité virtuelle est prise en charge** .</span><span class="sxs-lookup"><span data-stu-id="8412d-154">Check the **Virtual Reality Supported** box.</span></span>
    * <span data-ttu-id="8412d-155">*Windows Mixed Reality doit être le kit de développement logiciel (SDK) de realisation virtuelle.*</span><span class="sxs-lookup"><span data-stu-id="8412d-155">*Windows Mixed Reality should be the Virtual Reality SDK.*</span></span>
* <span data-ttu-id="8412d-156">Créer une scène.</span><span class="sxs-lookup"><span data-stu-id="8412d-156">Create a scene.</span></span>
    * <span data-ttu-id="8412d-157">Dans la **hiérarchie** , cliquez avec le bouton droit sur **caméra principale** , sélectionnez **supprimer**.</span><span class="sxs-lookup"><span data-stu-id="8412d-157">In the **Hierarchy** right click **Main Camera** select **Delete**.</span></span>
    * <span data-ttu-id="8412d-158">À partir de **HoloToolkit > d’entrée > Prefabs** faire glisser **MixedRealityCameraParent** vers la **hiérarchie**.</span><span class="sxs-lookup"><span data-stu-id="8412d-158">From **HoloToolkit > Input > Prefabs** drag **MixedRealityCameraParent** to the **Hierarchy**.</span></span>
* <span data-ttu-id="8412d-159">Ajouter des hologrammes à la scène</span><span class="sxs-lookup"><span data-stu-id="8412d-159">Add Holograms to the scene</span></span>
    * <span data-ttu-id="8412d-160">À partir de **AppPrefabs** , faites glisser **skybox** vers la **vue scène**.</span><span class="sxs-lookup"><span data-stu-id="8412d-160">From **AppPrefabs** drag **Skybox** to the **Scene View**.</span></span>
    * <span data-ttu-id="8412d-161">Dans **AppPrefabs** , faites glisser les **gestionnaires** vers la **hiérarchie**.</span><span class="sxs-lookup"><span data-stu-id="8412d-161">From **AppPrefabs** drag **Managers** to the **Hierarchy**.</span></span>
    * <span data-ttu-id="8412d-162">Dans **AppPrefabs** , faites glisser l' **îlot** vers la **hiérarchie**.</span><span class="sxs-lookup"><span data-stu-id="8412d-162">From **AppPrefabs** drag **Island** to the **Hierarchy**.</span></span>
* <span data-ttu-id="8412d-163">Enregistrer et générer</span><span class="sxs-lookup"><span data-stu-id="8412d-163">Save And build</span></span>
    * <span data-ttu-id="8412d-164">Save ( **Control + S** ou **file > Save Scene**)</span><span class="sxs-lookup"><span data-stu-id="8412d-164">Save (either **Control+S** or **File > Save Scene**)</span></span>
    * <span data-ttu-id="8412d-165">Étant donné qu’il s’agit d’une nouvelle scène, vous devez la nommer.</span><span class="sxs-lookup"><span data-stu-id="8412d-165">Since this is a new scene, you'll need to name it.</span></span> <span data-ttu-id="8412d-166">Le nom n’a pas d’importance, mais nous utilisons SharedMixedReality.</span><span class="sxs-lookup"><span data-stu-id="8412d-166">Name doesn't matter, but we use SharedMixedReality.</span></span>
* <span data-ttu-id="8412d-167">Exporter vers Visual Studio</span><span class="sxs-lookup"><span data-stu-id="8412d-167">Export To Visual Studio</span></span>
    * <span data-ttu-id="8412d-168">Ouvrez le menu Générer (**Ctrl + Maj + B** ou **fichier > paramètres de build**).</span><span class="sxs-lookup"><span data-stu-id="8412d-168">Open the build menu (**Control+Shift+B** or **File > Build Settings**)</span></span>
    * <span data-ttu-id="8412d-169">Cliquez sur **Ajouter des scènes ouvertes.**</span><span class="sxs-lookup"><span data-stu-id="8412d-169">Click **Add Open Scenes.**</span></span>
    * <span data-ttu-id="8412d-170">Vérifier **les C# projets Unity**</span><span class="sxs-lookup"><span data-stu-id="8412d-170">Check **Unity C# Projects**</span></span>
    * <span data-ttu-id="8412d-171">Cliquez sur **Build**.</span><span class="sxs-lookup"><span data-stu-id="8412d-171">Click **Build**.</span></span>
    * <span data-ttu-id="8412d-172">Dans la fenêtre de l’Explorateur de fichiers qui s’affiche, créez un nouveau dossier nommé **app**.</span><span class="sxs-lookup"><span data-stu-id="8412d-172">In the file explorer window that appears, create a New Folder named **App**.</span></span>
    * <span data-ttu-id="8412d-173">Cliquez sur le dossier de l' **application** .</span><span class="sxs-lookup"><span data-stu-id="8412d-173">Single click the **App** folder.</span></span>
    * <span data-ttu-id="8412d-174">Appuyez sur **Sélectionner un dossier.**</span><span class="sxs-lookup"><span data-stu-id="8412d-174">Press **Select Folder.**</span></span>
    * <span data-ttu-id="8412d-175">**Attendre la fin de la génération**</span><span class="sxs-lookup"><span data-stu-id="8412d-175">**Wait for the build to complete**</span></span>
    * <span data-ttu-id="8412d-176">Dans la fenêtre de l’Explorateur de fichiers qui s’affiche, accédez au dossier de l' **application** .</span><span class="sxs-lookup"><span data-stu-id="8412d-176">In the file explorer window that appears, navigate into the **App** folder.</span></span>
    * <span data-ttu-id="8412d-177">Double-cliquez sur **SharedMixedReality. sln** pour lancer Visual Studio</span><span class="sxs-lookup"><span data-stu-id="8412d-177">Double-click **SharedMixedReality.sln** to launch Visual Studio</span></span>
* <span data-ttu-id="8412d-178">Générer à partir de Visual Studio</span><span class="sxs-lookup"><span data-stu-id="8412d-178">Build From Visual Studio</span></span>
    * <span data-ttu-id="8412d-179">À l’aide de la barre d’outils supérieure, remplacez cible par **Release** et **x86**.</span><span class="sxs-lookup"><span data-stu-id="8412d-179">Using the top toolbar change target to **Release** and **x86**.</span></span>
    * <span data-ttu-id="8412d-180">Cliquez sur la flèche en regard de **ordinateur local** , puis sélectionnez l' **appareil** à déployer dans HoloLens</span><span class="sxs-lookup"><span data-stu-id="8412d-180">Click the arrow next to **Local Machine** and select **Device** to deploy to HoloLens</span></span>
    * <span data-ttu-id="8412d-181">Cliquez sur la flèche en regard de **périphérique** , puis sélectionnez **ordinateur local** à déployer pour le casque de la réalité mixte.</span><span class="sxs-lookup"><span data-stu-id="8412d-181">Click the arrow next to **Device** and select **Local Machine** to deploy for the mixed reality headset.</span></span>
    * <span data-ttu-id="8412d-182">Cliquez sur déboguer **-> exécuter sans débogage** ou sur **CTRL + F5** pour démarrer l’application.</span><span class="sxs-lookup"><span data-stu-id="8412d-182">Click **Debug->Start Without Debugging** or **Control+F5** to start the application.</span></span>

### <a name="digging-into-the-code"></a><span data-ttu-id="8412d-183">Examen du code</span><span class="sxs-lookup"><span data-stu-id="8412d-183">Digging into the code</span></span>

<span data-ttu-id="8412d-184">Dans le panneau projet, accédez à **Assets\HoloToolkit\Input\Scripts\Utilities** et double-cliquez sur **MixedRealityCameraManager.cs** pour l’ouvrir.</span><span class="sxs-lookup"><span data-stu-id="8412d-184">In the project panel, navigate to **Assets\HoloToolkit\Input\Scripts\Utilities** and double click **MixedRealityCameraManager.cs** to open it.</span></span>

<span data-ttu-id="8412d-185">**Vue** MixedRealityCameraManager.cs est un script simple qui ajuste le niveau de qualité et les paramètres d’arrière-plan en fonction de l’appareil.</span><span class="sxs-lookup"><span data-stu-id="8412d-185">**Overview:** MixedRealityCameraManager.cs is a simple script that adjusts quality level and background settings based on the device.</span></span> <span data-ttu-id="8412d-186">La clé ici est HolographicSettings. IsDisplayOpaque, qui permet à un script de détecter si l’appareil est un HoloLens (IsDisplayOpaque retourne la valeur false) ou un casque immersif (IsDisplayOpaque retourne la valeur true).</span><span class="sxs-lookup"><span data-stu-id="8412d-186">Key here is HolographicSettings.IsDisplayOpaque, which allows a script to detect if the device is a HoloLens (IsDisplayOpaque returns false) or an immersive headset (IsDisplayOpaque returns true).</span></span>

### <a name="enjoy-your-progress"></a><span data-ttu-id="8412d-187">Profitez de votre progression</span><span class="sxs-lookup"><span data-stu-id="8412d-187">Enjoy your progress</span></span>

<span data-ttu-id="8412d-188">À ce stade, l’application affichera simplement un hologramme.</span><span class="sxs-lookup"><span data-stu-id="8412d-188">At this point the application will just render a hologram.</span></span> <span data-ttu-id="8412d-189">Nous ajouterons l’interaction à l’hologramme ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="8412d-189">We will add interaction to the hologram later.</span></span> <span data-ttu-id="8412d-190">Les deux appareils affichent l’hologramme de la même façon.</span><span class="sxs-lookup"><span data-stu-id="8412d-190">Both devices will render the hologram the same.</span></span> <span data-ttu-id="8412d-191">Le casque immersif affiche également un arrière-plan bleu ciel et Clouds.</span><span class="sxs-lookup"><span data-stu-id="8412d-191">The immersive headset will also render a blue sky and clouds background.</span></span>

## <a name="chapter-2---interaction"></a><span data-ttu-id="8412d-192">Chapitre 2-interaction</span><span class="sxs-lookup"><span data-stu-id="8412d-192">Chapter 2 - Interaction</span></span>

>[!VIDEO https://www.youtube.com/embed/Lrb1y4sQRvI]

### <a name="objectives"></a><span data-ttu-id="8412d-193">Objectifs</span><span class="sxs-lookup"><span data-stu-id="8412d-193">Objectives</span></span>

<span data-ttu-id="8412d-194">Montrez comment gérer les entrées pour une application Windows Mixed Reality.</span><span class="sxs-lookup"><span data-stu-id="8412d-194">Show how to handle input for a Windows Mixed Reality application.</span></span>

### <a name="what-we-will-build"></a><span data-ttu-id="8412d-195">Ce que nous allons créer</span><span class="sxs-lookup"><span data-stu-id="8412d-195">What we will build</span></span>

<span data-ttu-id="8412d-196">En s’appuyant sur l’application du chapitre 1, nous ajouterons des fonctionnalités pour permettre à l’utilisateur de sélectionner l’hologramme et de le placer sur une surface dans le monde réel dans HoloLens ou sur une table virtuelle dans un casque immersif.</span><span class="sxs-lookup"><span data-stu-id="8412d-196">Building on the application from chapter 1, we will add functionality to allow the user to pick up the hologram and place it on a real world surface in HoloLens or on a virtual table in an immersive headset.</span></span>

<span data-ttu-id="8412d-197">**Actualisateur d’entrée:** Sur HoloLens, le geste de sélection est le **robinet d’air**.</span><span class="sxs-lookup"><span data-stu-id="8412d-197">**Input Refresher:** On HoloLens the select gesture is the **air tap**.</span></span> <span data-ttu-id="8412d-198">Sur les casques immersifs, nous allons utiliser le bouton **A** sur le contrôleur Xbox.</span><span class="sxs-lookup"><span data-stu-id="8412d-198">On immersive headsets, we will use the **A** button on the Xbox controller.</span></span> <span data-ttu-id="8412d-199">Pour plus d’informations sur l’entrée, cliquez [ici](gestures.md).</span><span class="sxs-lookup"><span data-stu-id="8412d-199">For more information on input [start here](gestures.md).</span></span>

### <a name="steps"></a><span data-ttu-id="8412d-200">Étapes</span><span class="sxs-lookup"><span data-stu-id="8412d-200">Steps</span></span>
* <span data-ttu-id="8412d-201">Ajouter un gestionnaire d’entrée</span><span class="sxs-lookup"><span data-stu-id="8412d-201">Add Input manager</span></span>
    * <span data-ttu-id="8412d-202">À partir de **HoloToolkit > d’entrée > Prefabs** faire glisser **InputManager** vers la **hiérarchie** en tant qu’enfant de **managers**.</span><span class="sxs-lookup"><span data-stu-id="8412d-202">From **HoloToolkit > Input > Prefabs** drag **InputManager** to **Hierarchy** as a child of **Managers**.</span></span>
    * <span data-ttu-id="8412d-203">À partir de **HoloToolkit > entrée > curseur de > Prefabs** , faites glisser **Cursor** vers **Hierarchy**.</span><span class="sxs-lookup"><span data-stu-id="8412d-203">From **HoloToolkit > Input > Prefabs > Cursor** drag **Cursor** to **Hierarchy**.</span></span>
* <span data-ttu-id="8412d-204">Ajouter un mappage spatial</span><span class="sxs-lookup"><span data-stu-id="8412d-204">Add Spatial Mapping</span></span>
    * <span data-ttu-id="8412d-205">À partir de **HoloToolkit > SpatialMapping > Prefabs** faites glisser **SpatialMapping** vers la **hiérarchie**.</span><span class="sxs-lookup"><span data-stu-id="8412d-205">From **HoloToolkit > SpatialMapping > Prefabs** drag **SpatialMapping** to **Hierarchy**.</span></span>
* <span data-ttu-id="8412d-206">Ajouter des PlaySpace virtuels</span><span class="sxs-lookup"><span data-stu-id="8412d-206">Add Virtual Playspace</span></span>
    * <span data-ttu-id="8412d-207">Dans **hiérarchie** , développez **MixedRealityCameraParent** sélectionner une **limite**</span><span class="sxs-lookup"><span data-stu-id="8412d-207">In **Hierarchy** expand **MixedRealityCameraParent** select **Boundary**</span></span>
    * <span data-ttu-id="8412d-208">Dans le panneau **inspecteur** , cochez la case pour activer la **limite**</span><span class="sxs-lookup"><span data-stu-id="8412d-208">In **Inspector** panel check the box to enable **Boundary**</span></span>
    * <span data-ttu-id="8412d-209">Dans **AppPrefabs** , faites glisser **VRRoom** vers la **hiérarchie**.</span><span class="sxs-lookup"><span data-stu-id="8412d-209">From **AppPrefabs** drag **VRRoom** to **Hierarchy**.</span></span>
* <span data-ttu-id="8412d-210">Ajouter WorldAnchorManager</span><span class="sxs-lookup"><span data-stu-id="8412d-210">Add WorldAnchorManager</span></span>
    * <span data-ttu-id="8412d-211">Dans **hiérarchie**, sélectionnez **gestionnaires**.</span><span class="sxs-lookup"><span data-stu-id="8412d-211">In **Hierarchy**, Select **Managers**.</span></span>
    * <span data-ttu-id="8412d-212">Dans **Inspector**, cliquez sur **Ajouter un composant**.</span><span class="sxs-lookup"><span data-stu-id="8412d-212">In **Inspector**, click **Add Component**.</span></span>
    * <span data-ttu-id="8412d-213">Tapez **World Anchor Manager**.</span><span class="sxs-lookup"><span data-stu-id="8412d-213">Type **World Anchor Manager**.</span></span>
    * <span data-ttu-id="8412d-214">Sélectionnez **World Anchor Manager** pour l’ajouter.</span><span class="sxs-lookup"><span data-stu-id="8412d-214">Select **World Anchor Manager** to add it.</span></span>
* <span data-ttu-id="8412d-215">Ajouter TapToPlace à l’îlot</span><span class="sxs-lookup"><span data-stu-id="8412d-215">Add TapToPlace to the Island</span></span>
    * <span data-ttu-id="8412d-216">Dans **hiérarchie**, développez **îlot**.</span><span class="sxs-lookup"><span data-stu-id="8412d-216">In **Hierarchy**, expand **Island**.</span></span>
    * <span data-ttu-id="8412d-217">Sélectionnez **MixedRealityLand**.</span><span class="sxs-lookup"><span data-stu-id="8412d-217">Select **MixedRealityLand**.</span></span>
    * <span data-ttu-id="8412d-218">Dans **Inspector**, cliquez sur **Ajouter un composant**.</span><span class="sxs-lookup"><span data-stu-id="8412d-218">In **Inspector**, click **Add Component**.</span></span>
    * <span data-ttu-id="8412d-219">Tapez **TAP pour la placer** et sélectionnez-le.</span><span class="sxs-lookup"><span data-stu-id="8412d-219">Type **Tap To Place** and select it.</span></span>
    * <span data-ttu-id="8412d-220">Cochez **Placer le parent sur TAP**.</span><span class="sxs-lookup"><span data-stu-id="8412d-220">Check **Place Parent On Tap**.</span></span>
    * <span data-ttu-id="8412d-221">Définissez **décalage de placement** sur **(0, 0,1, 0)** .</span><span class="sxs-lookup"><span data-stu-id="8412d-221">Set **Placement Offset** to **(0, 0.1, 0)**.</span></span>
* <span data-ttu-id="8412d-222">Enregistrer et générer comme avant</span><span class="sxs-lookup"><span data-stu-id="8412d-222">Save and Build as before</span></span>

### <a name="digging-into-the-code"></a><span data-ttu-id="8412d-223">Examen du code</span><span class="sxs-lookup"><span data-stu-id="8412d-223">Digging into the code</span></span>

<span data-ttu-id="8412d-224">**Script 1-GamepadInput.cs**</span><span class="sxs-lookup"><span data-stu-id="8412d-224">**Script 1 - GamepadInput.cs**</span></span>

<span data-ttu-id="8412d-225">Dans le panneau projet, accédez à **Assets\HoloToolkit\Input\Scripts\InputSources** et double-cliquez sur **GamepadInput.cs** pour l’ouvrir.</span><span class="sxs-lookup"><span data-stu-id="8412d-225">In the project panel navigate to **Assets\HoloToolkit\Input\Scripts\InputSources** and double click **GamepadInput.cs** to open it.</span></span> <span data-ttu-id="8412d-226">À partir du même chemin d’accès dans le panneau projet, double-cliquez sur **InteractionSourceInputSource.cs**.</span><span class="sxs-lookup"><span data-stu-id="8412d-226">From the same path in the project panel, also double click **InteractionSourceInputSource.cs**.</span></span>

<span data-ttu-id="8412d-227">Notez que les deux scripts ont une classe de base commune, BaseInputSource.</span><span class="sxs-lookup"><span data-stu-id="8412d-227">Note that both scripts have a common base class, BaseInputSource.</span></span>

<span data-ttu-id="8412d-228">BaseInputSource conserve une référence à un InputManager, qui permet à un script de déclencher des événements.</span><span class="sxs-lookup"><span data-stu-id="8412d-228">BaseInputSource keeps a reference to an InputManager, which allows a script to trigger events.</span></span> <span data-ttu-id="8412d-229">Dans ce cas, l’événement InputClicked est pertinent.</span><span class="sxs-lookup"><span data-stu-id="8412d-229">In this case, the InputClicked event is relevant.</span></span> <span data-ttu-id="8412d-230">Il est important de se souvenir quand nous obtenons le script 2, TapToPlace.</span><span class="sxs-lookup"><span data-stu-id="8412d-230">This will be important to remember when we get to script 2, TapToPlace.</span></span> <span data-ttu-id="8412d-231">Dans le cas de GamePadInput, nous interrogeons le bouton A sur le contrôleur à enfoncer, puis nous déclencherons l’événement InputClicked.</span><span class="sxs-lookup"><span data-stu-id="8412d-231">In the case of GamePadInput, we poll for the A button on the controller to be pressed, then we raise the InputClicked event.</span></span> <span data-ttu-id="8412d-232">Dans le cas de InteractionSourceInputSource, l’événement InputClicked est déclenché en réponse au TappedEvent.</span><span class="sxs-lookup"><span data-stu-id="8412d-232">In the case of InteractionSourceInputSource, we raise the InputClicked event in response to the TappedEvent.</span></span>

<span data-ttu-id="8412d-233">**Script 2-TapToPlace.cs**</span><span class="sxs-lookup"><span data-stu-id="8412d-233">**Script 2 - TapToPlace.cs**</span></span>

<span data-ttu-id="8412d-234">Dans le panneau projet, accédez à **Assets\HoloToolkit\SpatialMapping\Scripts** et double-cliquez sur **TapToPlace.cs** pour l’ouvrir.</span><span class="sxs-lookup"><span data-stu-id="8412d-234">In the project panel navigate to **Assets\HoloToolkit\SpatialMapping\Scripts** and double click **TapToPlace.cs** to open it.</span></span>

<span data-ttu-id="8412d-235">La première chose que de nombreux développeurs souhaitent implémenter lors de la création d’une application holographique est le déplacement d’hologrammes avec entrée de mouvement.</span><span class="sxs-lookup"><span data-stu-id="8412d-235">The first thing many developers want to implement when creating a Holographic application is moving Holograms with gesture input.</span></span> <span data-ttu-id="8412d-236">C’est pourquoi nous avons fait en sorte de formuler des commentaires sur ce script.</span><span class="sxs-lookup"><span data-stu-id="8412d-236">As such, we've endeavored to thoroughly comment this script.</span></span> <span data-ttu-id="8412d-237">Quelques points méritent une mise en évidence pour ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="8412d-237">A few things are worth highlighting for this tutorial.</span></span>

<span data-ttu-id="8412d-238">Tout d’abord, Notez que TapToPlace implémente IInputClickHandler.</span><span class="sxs-lookup"><span data-stu-id="8412d-238">First, note that TapToPlace implements IInputClickHandler.</span></span> <span data-ttu-id="8412d-239">IInputClickHandler expose les fonctions qui gèrent l’événement InputClicked déclenché par GamePadInput.cs ou InteractionSourceInputSource.cs.</span><span class="sxs-lookup"><span data-stu-id="8412d-239">IInputClickHandler exposes the functions that handle the InputClicked event raised by GamePadInput.cs or InteractionSourceInputSource.cs.</span></span> <span data-ttu-id="8412d-240">OnInputClicked est appelé lorsqu’un BaseInputSource détecte un clic alors que l’objet avec TapToPlace est actif.</span><span class="sxs-lookup"><span data-stu-id="8412d-240">OnInputClicked is called when a BaseInputSource detects a click while the object with TapToPlace is in focus.</span></span> <span data-ttu-id="8412d-241">L’activation de la pression sur HoloLens ou sur le bouton A sur le contrôleur Xbox déclenche l’événement.</span><span class="sxs-lookup"><span data-stu-id="8412d-241">Either airtapping on HoloLens or pressing the A button on the Xbox controller will trigger the event.</span></span>

<span data-ttu-id="8412d-242">Deuxièmement, le code doit être exécuté dans Update pour voir si une surface est recherchée afin que nous puissions placer l’objet de jeu sur une surface, par exemple une table.</span><span class="sxs-lookup"><span data-stu-id="8412d-242">Second is the code be executed in update to see if a surface is being looked at so we can place the game object on a surface, like a table.</span></span> <span data-ttu-id="8412d-243">Le casque immersif n’a pas de concept de surfaces réelles, donc l’objet qui représente la table Top (Vroom > TableThingy > cube) a été marqué avec la couche physique SpatialMapping, de sorte que la mise à jour de Ray est en conflit avec la table virtuelle Top.</span><span class="sxs-lookup"><span data-stu-id="8412d-243">The immersive headset doesn't have a concept of real surfaces, so the object that represents the table top (Vroom > TableThingy > Cube) has been marked with the SpatialMapping physics layer, so the ray cast in Update will collide with the virtual table top.</span></span>

### <a name="enjoy-your-progress"></a><span data-ttu-id="8412d-244">Profitez de votre progression</span><span class="sxs-lookup"><span data-stu-id="8412d-244">Enjoy your progress</span></span>

<span data-ttu-id="8412d-245">Cette fois, vous pouvez sélectionner l’îlot pour le déplacer.</span><span class="sxs-lookup"><span data-stu-id="8412d-245">This time you can select the island to move it.</span></span> <span data-ttu-id="8412d-246">Sur HoloLens, vous pouvez déplacer l’îlot vers une surface réelle.</span><span class="sxs-lookup"><span data-stu-id="8412d-246">On HoloLens you can move the island to a real surface.</span></span> <span data-ttu-id="8412d-247">Dans le casque immersif, vous pouvez déplacer l’îlot vers la table virtuelle que nous avons ajoutée.</span><span class="sxs-lookup"><span data-stu-id="8412d-247">In the immersive headset you can move the island to the virtual table we added.</span></span>

## <a name="chapter-3---sharing"></a><span data-ttu-id="8412d-248">Chapitre 3-partage</span><span class="sxs-lookup"><span data-stu-id="8412d-248">Chapter 3 - Sharing</span></span>

>[!VIDEO https://www.youtube.com/embed/1diycJvxfDc]

### <a name="objectives"></a><span data-ttu-id="8412d-249">Objectifs</span><span class="sxs-lookup"><span data-stu-id="8412d-249">Objectives</span></span>

<span data-ttu-id="8412d-250">Assurez-vous que le réseau est correctement configuré et comment les ancres spatiales sont partagées entre les appareils.</span><span class="sxs-lookup"><span data-stu-id="8412d-250">Ensure that the network is correctly configured and detail how spatial anchors are shared between devices.</span></span>

### <a name="what-we-will-build"></a><span data-ttu-id="8412d-251">Ce que nous allons créer</span><span class="sxs-lookup"><span data-stu-id="8412d-251">What we will build</span></span>

<span data-ttu-id="8412d-252">Nous allons convertir notre projet en projet multijoueur.</span><span class="sxs-lookup"><span data-stu-id="8412d-252">We will convert our project to a multiplayer project.</span></span> <span data-ttu-id="8412d-253">Nous allons ajouter l’interface utilisateur et la logique pour héberger ou joindre des sessions.</span><span class="sxs-lookup"><span data-stu-id="8412d-253">We will add UI and logic to host or join sessions.</span></span> <span data-ttu-id="8412d-254">Les utilisateurs de HoloLens s’afficheront dans la session avec des clouds sur leurs têtes, et les utilisateurs de casque immersif présenteront des clouds proches de l’emplacement où se trouve l’ancre.</span><span class="sxs-lookup"><span data-stu-id="8412d-254">HoloLens users will see each other in the session with clouds over their heads, and immersive headset users have clouds near to where the anchor is.</span></span> <span data-ttu-id="8412d-255">Les utilisateurs des casques immersifs verront les utilisateurs HoloLens par rapport à l’origine de la scène.</span><span class="sxs-lookup"><span data-stu-id="8412d-255">Users in the immersive headsets will see the HoloLens users relative to the origin of the scene.</span></span> <span data-ttu-id="8412d-256">Les utilisateurs de HoloLens verront tous l’hologramme de l’île au même endroit.</span><span class="sxs-lookup"><span data-stu-id="8412d-256">HoloLens users will all see the hologram of the island in the same place.</span></span> <span data-ttu-id="8412d-257">Il est important de noter que les utilisateurs des casques immersifs ne seront pas sur l’île au cours de ce chapitre, mais ils se comportent de la même façon que HoloLens, avec une vue d’ensemble des oiseaux de l’île.</span><span class="sxs-lookup"><span data-stu-id="8412d-257">It is key to note that the users in the immersive headsets will not be on the island during this chapter, but will behave very similarly to HoloLens, with a birds eye view of the island.</span></span>

### <a name="steps"></a><span data-ttu-id="8412d-258">Étapes</span><span class="sxs-lookup"><span data-stu-id="8412d-258">Steps</span></span>
* <span data-ttu-id="8412d-259">Supprimer l’îlot et VRRoom</span><span class="sxs-lookup"><span data-stu-id="8412d-259">Remove Island and VRRoom</span></span>
    * <span data-ttu-id="8412d-260">Dans **hiérarchie** , cliquez avec le bouton droit sur **îlot** sélectionner **supprimer**</span><span class="sxs-lookup"><span data-stu-id="8412d-260">In **Hierarchy** right-click **Island** select **Delete**</span></span>
    * <span data-ttu-id="8412d-261">Dans **hiérarchie** , cliquez avec le bouton droit sur **VRRoom** sélectionner **supprimer**</span><span class="sxs-lookup"><span data-stu-id="8412d-261">In **Hierarchy** right-click **VRRoom** select **Delete**</span></span>
* <span data-ttu-id="8412d-262">Ajouter Usland</span><span class="sxs-lookup"><span data-stu-id="8412d-262">Add Usland</span></span>
    * <span data-ttu-id="8412d-263">Dans **AppPrefabs** , faites glisser **Usland** vers la **hiérarchie**.</span><span class="sxs-lookup"><span data-stu-id="8412d-263">From **AppPrefabs** drag **Usland** to **Hierarchy**.</span></span>
* <span data-ttu-id="8412d-264">Dans **AppPrefabs** , faites glisser chacun des éléments suivants vers la **hiérarchie**:</span><span class="sxs-lookup"><span data-stu-id="8412d-264">From **AppPrefabs** drag each of the following to **Hierarchy**:</span></span>
    * <span data-ttu-id="8412d-265">**UNETSharingStage**</span><span class="sxs-lookup"><span data-stu-id="8412d-265">**UNETSharingStage**</span></span>
    * <span data-ttu-id="8412d-266">**UNetAnchorRoot**</span><span class="sxs-lookup"><span data-stu-id="8412d-266">**UNetAnchorRoot**</span></span>
    * <span data-ttu-id="8412d-267">**UIContainer**</span><span class="sxs-lookup"><span data-stu-id="8412d-267">**UIContainer**</span></span>
    * <span data-ttu-id="8412d-268">**DebugPanelButton**</span><span class="sxs-lookup"><span data-stu-id="8412d-268">**DebugPanelButton**</span></span>
* <span data-ttu-id="8412d-269">Enregistrer et générer comme avant</span><span class="sxs-lookup"><span data-stu-id="8412d-269">Save and Build as before</span></span>

### <a name="digging-into-the-code"></a><span data-ttu-id="8412d-270">Examen du code</span><span class="sxs-lookup"><span data-stu-id="8412d-270">Digging into the code</span></span>

<span data-ttu-id="8412d-271">Dans le panneau projet, accédez à **Assets\AppPrefabs\Support\SharingWithUnet\Scripts** et double-cliquez sur **UnetAnchorManager.cs**.</span><span class="sxs-lookup"><span data-stu-id="8412d-271">In the project panel, navigate to **Assets\AppPrefabs\Support\SharingWithUnet\Scripts** and double-click on **UnetAnchorManager.cs**.</span></span> <span data-ttu-id="8412d-272">La possibilité pour un HoloLens de partager des informations de suivi avec un autre HoloLens de telle sorte que les deux appareils puissent partager le même espace est presque magique.</span><span class="sxs-lookup"><span data-stu-id="8412d-272">The ability for one HoloLens to share tracking information with another HoloLens such that both devices can share the same space is near magical.</span></span> <span data-ttu-id="8412d-273">La puissance de la réalité mixte est active lorsque deux personnes ou plus peuvent collaborer à l’aide des mêmes données numériques.</span><span class="sxs-lookup"><span data-stu-id="8412d-273">The power of mixed reality comes alive when two or more people can collaborate using the same digital data.</span></span>

<span data-ttu-id="8412d-274">Voici quelques éléments à souligner dans ce script:</span><span class="sxs-lookup"><span data-stu-id="8412d-274">A few things to point out in this script:</span></span>

<span data-ttu-id="8412d-275">Dans la fonction Start, notez la vérification de **IsDisplayOpaque**.</span><span class="sxs-lookup"><span data-stu-id="8412d-275">In the start function, notice the check for **IsDisplayOpaque**.</span></span> <span data-ttu-id="8412d-276">Dans ce cas, nous supposons que le point d’ancrage est établi.</span><span class="sxs-lookup"><span data-stu-id="8412d-276">In this case, we pretend that the Anchor is established.</span></span> <span data-ttu-id="8412d-277">Cela est dû au fait que les casques immersifs n’exposent pas un moyen d’importer ou d’exporter des ancres.</span><span class="sxs-lookup"><span data-stu-id="8412d-277">This is because the immersive headsets do not expose a way to import or export anchors.</span></span> <span data-ttu-id="8412d-278">Toutefois, si nous exécutons un HoloLens, ce script implémente des ancres de partage entre les appareils.</span><span class="sxs-lookup"><span data-stu-id="8412d-278">If we are running on a HoloLens, however, this script implements sharing anchors between the devices.</span></span> <span data-ttu-id="8412d-279">L’appareil qui démarre la session crée une ancre pour l’exportation.</span><span class="sxs-lookup"><span data-stu-id="8412d-279">The device that starts the session will create an anchor for exporting.</span></span> <span data-ttu-id="8412d-280">L’appareil qui rejoint une session demande l’ancre à partir de l’appareil qui a démarré la session.</span><span class="sxs-lookup"><span data-stu-id="8412d-280">The device that joins a session will request the anchor from the device that started the session.</span></span>

<span data-ttu-id="8412d-281">**Export**</span><span class="sxs-lookup"><span data-stu-id="8412d-281">**Exporting:**</span></span>

<span data-ttu-id="8412d-282">Lorsqu’un utilisateur crée une session, NetworkDiscoveryWithAnchors appelle la fonction UNETAnchorManagers CreateAnchor.</span><span class="sxs-lookup"><span data-stu-id="8412d-282">When a user creates a session, NetworkDiscoveryWithAnchors will call UNETAnchorManagers CreateAnchor function.</span></span> <span data-ttu-id="8412d-283">Nous allons suivre CreateAnchor Flow.</span><span class="sxs-lookup"><span data-stu-id="8412d-283">Let's follow CreateAnchor flow.</span></span>

<span data-ttu-id="8412d-284">Nous commençons par la maintenance, en effaçant toutes les données que nous avons pu collecter pour les ancres précédentes.</span><span class="sxs-lookup"><span data-stu-id="8412d-284">We start by doing some housekeeping, clearing out any data we may have collected for previous anchors.</span></span> <span data-ttu-id="8412d-285">Nous vérifions ensuite s’il y a une ancre mise en cache à charger.</span><span class="sxs-lookup"><span data-stu-id="8412d-285">Then we check if there is a cached anchor to load.</span></span> <span data-ttu-id="8412d-286">Les données d’ancrage ont tendance à avoir une taille comprise entre 5 et 20 Mo. par conséquent, la réutilisation des ancres mises en cache peut économiser sur la quantité de données que nous devons transférer sur le réseau.</span><span class="sxs-lookup"><span data-stu-id="8412d-286">The anchor data tends to be between 5 and 20 MB, so reusing cached anchors can save on the amount of data we need to transfer over the network.</span></span> <span data-ttu-id="8412d-287">Nous verrons comment cela fonctionne un peu plus tard.</span><span class="sxs-lookup"><span data-stu-id="8412d-287">We'll see how this works a bit later.</span></span> <span data-ttu-id="8412d-288">Même si nous réutilisons le point d’ancrage, nous devons recevoir les données d’ancrage au cas où un nouveau client se connecte sans le point d’ancrage.</span><span class="sxs-lookup"><span data-stu-id="8412d-288">Even if we are reusing the anchor, we need to get the anchor data ready in case a new client joins that doesn't have the anchor.</span></span>

<span data-ttu-id="8412d-289">En ce qui concerne l’obtention des données d’ancrage, la classe WorldAnchorTransferBatch expose les fonctionnalités permettant de préparer les données d’ancrage pour les envoyer à un autre périphérique ou une autre application, ainsi que les fonctionnalités permettant d’importer les données d’ancrage.</span><span class="sxs-lookup"><span data-stu-id="8412d-289">Speaking of getting the anchor data ready, the WorldAnchorTransferBatch class exposes the functionality to prepare anchor data for sending to another device or application and the functionality to import the anchor data.</span></span> <span data-ttu-id="8412d-290">Étant donné que nous sommes dans le chemin d’exportation, nous allons ajouter notre point d’ancrage au WorldAnchorTransferBatch et appeler la fonction ExportAsync.</span><span class="sxs-lookup"><span data-stu-id="8412d-290">Since we're on the export path, we will add our anchor to the WorldAnchorTransferBatch and call the ExportAsync function.</span></span> <span data-ttu-id="8412d-291">ExportAsync appellera ensuite le rappel WriteBuffer lors de la génération de données pour l’exportation.</span><span class="sxs-lookup"><span data-stu-id="8412d-291">ExportAsync will then call the WriteBuffer callback as it generates data for export.</span></span> <span data-ttu-id="8412d-292">Lorsque toutes les données ont été exportées, ExportComplete est appelé.</span><span class="sxs-lookup"><span data-stu-id="8412d-292">When all of the data has been exported ExportComplete will be called.</span></span> <span data-ttu-id="8412d-293">Dans WriteBuffer, nous ajoutons le segment de données à une liste que nous conservons pour l’exportation.</span><span class="sxs-lookup"><span data-stu-id="8412d-293">In WriteBuffer we add the chunk of data to a list we keep for exporting.</span></span> <span data-ttu-id="8412d-294">Dans ExportComplete, nous allons convertir la liste en tableau.</span><span class="sxs-lookup"><span data-stu-id="8412d-294">In ExportComplete we convert the list to an array.</span></span> <span data-ttu-id="8412d-295">La variable AnchorName est également définie, ce qui déclenche la demande de l’ancre à d’autres appareils, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="8412d-295">The AnchorName variable is also set, which will trigger other devices to request the anchor if they don't have it.</span></span>

<span data-ttu-id="8412d-296">Dans certains cas, le point d’ancrage n’exportera pas ou créera donc un petit nombre de données que nous réessaierons.</span><span class="sxs-lookup"><span data-stu-id="8412d-296">In some cases the anchor won't export or will create so little data that we will try again.</span></span> <span data-ttu-id="8412d-297">Ici, nous appelons simplement CreateAnchor.</span><span class="sxs-lookup"><span data-stu-id="8412d-297">Here we just call CreateAnchor again.</span></span>

<span data-ttu-id="8412d-298">Une fonction finale dans le chemin d’exportation est AnchorFoundRemotely.</span><span class="sxs-lookup"><span data-stu-id="8412d-298">A final function in the export path is AnchorFoundRemotely.</span></span> <span data-ttu-id="8412d-299">Lorsqu’un autre appareil trouve le point d’ancrage, cet appareil indique à l’ordinateur hôte, et l’hôte l’utilise comme signal indiquant que l’ancre est une «bonne ancre» et peut être mise en cache.</span><span class="sxs-lookup"><span data-stu-id="8412d-299">When another device finds the anchor, that device will tell the host, and the host will use that as a signal that the anchor is a "good anchor" and can be cached.</span></span>

<span data-ttu-id="8412d-300">**Destination**</span><span class="sxs-lookup"><span data-stu-id="8412d-300">**Importing:**</span></span>

<span data-ttu-id="8412d-301">Lorsqu’un HoloLens rejoint une session, il doit importer une ancre.</span><span class="sxs-lookup"><span data-stu-id="8412d-301">When a HoloLens joins a session, it needs to import an anchor.</span></span> <span data-ttu-id="8412d-302">Dans la fonction de mise à jour de UNETAnchorManager, le AnchorName est interrogé.</span><span class="sxs-lookup"><span data-stu-id="8412d-302">In UNETAnchorManager's Update function, the AnchorName is polled.</span></span> <span data-ttu-id="8412d-303">Lorsque le nom d’ancrage change, le processus d’importation commence.</span><span class="sxs-lookup"><span data-stu-id="8412d-303">When the anchor name changes, the import process begins.</span></span> <span data-ttu-id="8412d-304">Tout d’abord, nous essayons de charger l’ancre avec le nom spécifié à partir du magasin d’ancrage local.</span><span class="sxs-lookup"><span data-stu-id="8412d-304">First, we try to load the anchor with the specified name from the local anchor store.</span></span> <span data-ttu-id="8412d-305">Si nous l’avons déjà, nous pouvons l’utiliser sans télécharger à nouveau les données.</span><span class="sxs-lookup"><span data-stu-id="8412d-305">If we already have it, we can use it without downloading the data again.</span></span> <span data-ttu-id="8412d-306">Si ce n’est pas le cas, nous appelons WaitForAnchor, ce qui va lancer le téléchargement.</span><span class="sxs-lookup"><span data-stu-id="8412d-306">If we don't have it, then we call WaitForAnchor which will initiate the download.</span></span>

<span data-ttu-id="8412d-307">Une fois le téléchargement terminé, NetworkTransmitter_dataReadyEvent est appelé.</span><span class="sxs-lookup"><span data-stu-id="8412d-307">When the download is completed, NetworkTransmitter_dataReadyEvent is called.</span></span> <span data-ttu-id="8412d-308">Cela indique à la boucle de mise à jour d’appeler ImportAsync avec les données téléchargées.</span><span class="sxs-lookup"><span data-stu-id="8412d-308">This will signal the Update loop to call ImportAsync with the downloaded data.</span></span> <span data-ttu-id="8412d-309">ImportAsync appellera ImportComplete lorsque le processus d’importation est terminé.</span><span class="sxs-lookup"><span data-stu-id="8412d-309">ImportAsync will call ImportComplete when the import process is complete.</span></span> <span data-ttu-id="8412d-310">Si l’importation réussit, le point d’ancrage est enregistré dans la Banque de lecteurs locale.</span><span class="sxs-lookup"><span data-stu-id="8412d-310">If the import is successful, the anchor will be saved in the local player store.</span></span> <span data-ttu-id="8412d-311">PlayerController.cs effectue en fait l’appel à AnchorFoundRemotely pour permettre à l’hôte de savoir qu’une bonne ancre a été établie.</span><span class="sxs-lookup"><span data-stu-id="8412d-311">PlayerController.cs actually makes the call to AnchorFoundRemotely to let the host know that a good anchor has been established.</span></span>

### <a name="enjoy-your-progress"></a><span data-ttu-id="8412d-312">Profitez de votre progression</span><span class="sxs-lookup"><span data-stu-id="8412d-312">Enjoy your progress</span></span>

<span data-ttu-id="8412d-313">Cette fois, un utilisateur disposant d’un HoloLens hébergera une session à l’aide du bouton **Démarrer la session** dans l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8412d-313">This time a user with a HoloLens will host a session using the **start session** button in the UI.</span></span> <span data-ttu-id="8412d-314">D’autres utilisateurs, à la fois sur HoloLens ou sur un casque immersif, sélectionnent la session, puis sélectionnent le bouton **rejoindre la session** dans l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8412d-314">Other users, both on HoloLens or an immersive headset, will select the session and then select the **join session** button in the UI.</span></span> <span data-ttu-id="8412d-315">Si vous avez plusieurs personnes avec des appareils HoloLens, elles auront des clouds rouges sur leurs têtes.</span><span class="sxs-lookup"><span data-stu-id="8412d-315">If you have multiple people with HoloLens devices, they will have red clouds over their heads.</span></span> <span data-ttu-id="8412d-316">Il y aura également un Cloud bleu pour chaque casque immersif, mais les clouds bleus ne seront pas au-dessus des casques, car les casques n’essaient pas de trouver les mêmes espaces de coordonnées universelles que les appareils HoloLens.</span><span class="sxs-lookup"><span data-stu-id="8412d-316">There will also be a blue cloud for each immersive headset, but the blue clouds will not be above the headsets, as the headsets are not trying to find the same world coordinate space as the HoloLens devices.</span></span>

<span data-ttu-id="8412d-317">Ce point dans le projet est une application de partage contenue. Il n’en fait pas beaucoup et peut servir de base.</span><span class="sxs-lookup"><span data-stu-id="8412d-317">This point in the project is a contained sharing application; it doesn't do very much, and could act as a baseline.</span></span> <span data-ttu-id="8412d-318">Dans les chapitres suivants, nous allons commencer à créer une expérience que les gens pourront apprécier.</span><span class="sxs-lookup"><span data-stu-id="8412d-318">In the next chapters, we will start building an experience for people to enjoy.</span></span> <span data-ttu-id="8412d-319">Pour obtenir des conseils supplémentaires sur la conception de l’expérience partagée, rendez-vous ici.</span><span class="sxs-lookup"><span data-stu-id="8412d-319">To get further guidance on shared experience design, go here.</span></span>

## <a name="chapter-4---immersion-and-teleporting"></a><span data-ttu-id="8412d-320">Chapitre 4-immersion et téléportage</span><span class="sxs-lookup"><span data-stu-id="8412d-320">Chapter 4 - Immersion and teleporting</span></span>

>[!VIDEO https://www.youtube.com/embed/kUHZ5tCOfvY]

### <a name="objectives"></a><span data-ttu-id="8412d-321">Objectifs</span><span class="sxs-lookup"><span data-stu-id="8412d-321">Objectives</span></span>

<span data-ttu-id="8412d-322">Traitez l’expérience de chaque type d’appareil de réalité mixte.</span><span class="sxs-lookup"><span data-stu-id="8412d-322">Cater the experience to each type of mixed reality device.</span></span>

### <a name="what-we-will-build"></a><span data-ttu-id="8412d-323">Ce que nous allons créer</span><span class="sxs-lookup"><span data-stu-id="8412d-323">What we will build</span></span>

<span data-ttu-id="8412d-324">Nous mettrons à jour l’application pour placer les utilisateurs du casque immersif sur l’île avec une vue immersive.</span><span class="sxs-lookup"><span data-stu-id="8412d-324">We will update the application to put immersive headset users on the island with an immersive view.</span></span> <span data-ttu-id="8412d-325">Les utilisateurs de HoloLens auront toujours la vue d’ensemble de l’île.</span><span class="sxs-lookup"><span data-stu-id="8412d-325">HoloLens users will still have the bird's eye view of the island.</span></span> <span data-ttu-id="8412d-326">Les utilisateurs de chaque type d’appareil peuvent voir d’autres utilisateurs tels qu’ils apparaissent dans le monde.</span><span class="sxs-lookup"><span data-stu-id="8412d-326">Users of each device type can see other users as they appear in the world.</span></span> <span data-ttu-id="8412d-327">Par exemple, les utilisateurs de casque immersif peuvent voir les autres avatars sur d’autres chemins d’accès sur l’île, et les utilisateurs HoloLens en tant que Clouds géants au-dessus de l’île.</span><span class="sxs-lookup"><span data-stu-id="8412d-327">For instance, immersive headset users can see the other avatars on other paths on the island, and they see the HoloLens users as giant clouds above the island.</span></span> <span data-ttu-id="8412d-328">Les utilisateurs du casque immersif verront également le curseur du point de regard de l’utilisateur HoloLens si l’utilisateur HoloLens regarde l’île.</span><span class="sxs-lookup"><span data-stu-id="8412d-328">Immersive headset users will also see the cursor of the HoloLens user's gaze ray if the HoloLens user is looking at the island.</span></span> <span data-ttu-id="8412d-329">Les utilisateurs de HoloLens verront un avatar sur l’île pour représenter chaque utilisateur de casque immersif.</span><span class="sxs-lookup"><span data-stu-id="8412d-329">HoloLens users will see an avatar on the island to represent each immersive headset user.</span></span>

<span data-ttu-id="8412d-330">**Entrée mise à jour pour l’appareil immersif:**</span><span class="sxs-lookup"><span data-stu-id="8412d-330">**Updated Input for the Immersive device:**</span></span>
* <span data-ttu-id="8412d-331">Les boutons du pare-chocs gauche et du pare-chocs droit sur le contrôleur Xbox font pivoter le lecteur</span><span class="sxs-lookup"><span data-stu-id="8412d-331">The left bumper and right bumper buttons on the Xbox controller rotate the player</span></span>
* <span data-ttu-id="8412d-332">Le maintien du bouton Y sur le contrôleur Xbox [active un curseur](navigating-the-windows-mixed-reality-home.md#getting-around-your-home) de téléopération.</span><span class="sxs-lookup"><span data-stu-id="8412d-332">Holding the Y button on the Xbox controller will enable a [teleport](navigating-the-windows-mixed-reality-home.md#getting-around-your-home) cursor.</span></span> <span data-ttu-id="8412d-333">Si le curseur a un indicateur de flèche en rotation lorsque vous relâchez le bouton Y, vous serez téléporté à l’emplacement du curseur.</span><span class="sxs-lookup"><span data-stu-id="8412d-333">If the cursor has a spinning arrow indicator when you release the Y button, you will be teleported to the cursor's location.</span></span>

### <a name="steps"></a><span data-ttu-id="8412d-334">Étapes</span><span class="sxs-lookup"><span data-stu-id="8412d-334">Steps</span></span>
* <span data-ttu-id="8412d-335">Ajouter MixedRealityTeleport à MixedRealityCameraParent</span><span class="sxs-lookup"><span data-stu-id="8412d-335">Add MixedRealityTeleport to MixedRealityCameraParent</span></span>
    * <span data-ttu-id="8412d-336">Dans **hiérarchie**, sélectionnez **Usland**.</span><span class="sxs-lookup"><span data-stu-id="8412d-336">In **Hierarchy**, select **Usland**.</span></span>
    * <span data-ttu-id="8412d-337">Dans **Inspector**, activez **le contrôle de niveau**.</span><span class="sxs-lookup"><span data-stu-id="8412d-337">In **Inspector**, enable **Level Control**.</span></span>
    * <span data-ttu-id="8412d-338">Dans **hiérarchie**, sélectionnez **MixedRealityCameraParent**.</span><span class="sxs-lookup"><span data-stu-id="8412d-338">In **Hierarchy**, select **MixedRealityCameraParent**.</span></span>
    * <span data-ttu-id="8412d-339">Dans **Inspector**, cliquez sur **Ajouter un composant**.</span><span class="sxs-lookup"><span data-stu-id="8412d-339">In **Inspector**, click **Add Component**.</span></span>
    * <span data-ttu-id="8412d-340">Tapez **Mixed realre** telela et sélectionnez-la.</span><span class="sxs-lookup"><span data-stu-id="8412d-340">Type **Mixed Reality Teleport** and select it.</span></span>

### <a name="digging-into-the-code"></a><span data-ttu-id="8412d-341">Examen du code</span><span class="sxs-lookup"><span data-stu-id="8412d-341">Digging into the code</span></span>

<span data-ttu-id="8412d-342">Les utilisateurs du casque immersif sont attachés à leurs PC avec un câble, mais notre îlot est plus grand que le câble est long.</span><span class="sxs-lookup"><span data-stu-id="8412d-342">Immersive headset users will be tethered to their PCs with a cable, but our island is larger than the cable is long.</span></span> <span data-ttu-id="8412d-343">Pour compenser, nous avons besoin de la possibilité de déplacer l’appareil photo indépendamment du mouvement de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8412d-343">To compensate, we need the ability to move the camera independently of the user's motion.</span></span> <span data-ttu-id="8412d-344">Pour plus d’informations sur la conception de votre application de réalité mixte (en particulier automotion et locomotion), consultez la [page Comfort](comfort.md) .</span><span class="sxs-lookup"><span data-stu-id="8412d-344">Please see the [comfort page](comfort.md) for more information about designing your mixed reality application (in particular self motion and locomotion).</span></span>

<span data-ttu-id="8412d-345">Pour pouvoir décrire ce processus, il est utile de définir deux termes.</span><span class="sxs-lookup"><span data-stu-id="8412d-345">In order to describe this process it will be useful to define two terms.</span></span> <span data-ttu-id="8412d-346">Tout d’abord, la **poupée** est l’objet qui déplace l’appareil photo indépendamment de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8412d-346">First, **dolly** will be the object that moves the camera independently from the user.</span></span> <span data-ttu-id="8412d-347">Un objet de jeu enfant de la **poupée** est l' **appareil photo principal**.</span><span class="sxs-lookup"><span data-stu-id="8412d-347">A child game object of the **dolly** will be the **main camera**.</span></span> <span data-ttu-id="8412d-348">La caméra principale est attachée à la tête de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8412d-348">The main camera is attached to the user's head.</span></span>

<span data-ttu-id="8412d-349">Dans le panneau projet, accédez à **Assets\AppPrefabs\Support\Scripts\GameLogic** et double-cliquez sur **MixedRealityTeleport.cs**.</span><span class="sxs-lookup"><span data-stu-id="8412d-349">In the project panel, navigate to **Assets\AppPrefabs\Support\Scripts\GameLogic** and double-click on **MixedRealityTeleport.cs**.</span></span>

<span data-ttu-id="8412d-350">MixedRealityTeleport a deux tâches.</span><span class="sxs-lookup"><span data-stu-id="8412d-350">MixedRealityTeleport has two jobs.</span></span> <span data-ttu-id="8412d-351">Tout d’abord, elle gère la rotation à l’aide des champignons.</span><span class="sxs-lookup"><span data-stu-id="8412d-351">First, it handles rotation using the bumpers.</span></span> <span data-ttu-id="8412d-352">Dans la fonction de mise à jour, nous interrogeons «ButtonUp» sur LeftBumper et RightBumper.</span><span class="sxs-lookup"><span data-stu-id="8412d-352">In the update function we poll for 'ButtonUp' on LeftBumper and RightBumper.</span></span> <span data-ttu-id="8412d-353">GetButtonUp retourne uniquement la valeur true sur la première image. un bouton est activé après avoir été enfoncé.</span><span class="sxs-lookup"><span data-stu-id="8412d-353">GetButtonUp only returns true on the first frame a button is up after having been down.</span></span> <span data-ttu-id="8412d-354">Si l’un des deux boutons a été déclenché, nous savons que l’utilisateur doit faire pivoter.</span><span class="sxs-lookup"><span data-stu-id="8412d-354">If either button had been raised, then we know the user needs to rotate.</span></span>

<span data-ttu-id="8412d-355">Lorsque nous faisons pivoter, nous faisons un fondu et un fondu dans à l’aide d’un script simple appelé «contrôle de fondu».</span><span class="sxs-lookup"><span data-stu-id="8412d-355">When we rotate we do a fade out and fade in using a simple script called 'fade control'.</span></span> <span data-ttu-id="8412d-356">Nous faisons cela pour empêcher l’utilisateur de voir un mouvement non naturel qui pourrait entraîner une gêne.</span><span class="sxs-lookup"><span data-stu-id="8412d-356">We do this to prevent the user from seeing an unnatural movement which could lead to discomfort.</span></span> <span data-ttu-id="8412d-357">L’effet d’atténuation et de sortie est relativement simple.</span><span class="sxs-lookup"><span data-stu-id="8412d-357">The fade in and out effect is fairly simple.</span></span> <span data-ttu-id="8412d-358">Nous avons un blocage noir à l’avant de la **caméra principale**.</span><span class="sxs-lookup"><span data-stu-id="8412d-358">We have a black quad hanging in front of the **main camera**.</span></span> <span data-ttu-id="8412d-359">En cas de fondu, nous transmettons la valeur alpha de 0 à 1.</span><span class="sxs-lookup"><span data-stu-id="8412d-359">When fading out we transition the alpha value from 0 to 1.</span></span> <span data-ttu-id="8412d-360">Cela provoque progressivement le rendu des pixels noirs du quad et leur masquage.</span><span class="sxs-lookup"><span data-stu-id="8412d-360">This gradually causes the black pixels of the quad to render and obscure anything behind them.</span></span> <span data-ttu-id="8412d-361">Lors du fondu, nous transférons la valeur alpha à zéro.</span><span class="sxs-lookup"><span data-stu-id="8412d-361">When fading back in we transition the alpha value back to zero.</span></span>

<span data-ttu-id="8412d-362">Lorsque nous calculons la rotation, Notez que nous allons faire pivoter notre **poupée** , mais en calculant la rotation autour de la **caméra principale**.</span><span class="sxs-lookup"><span data-stu-id="8412d-362">When we calculate the rotation, note that we are rotating our **dolly** but calculating the rotation around the **main camera**.</span></span> <span data-ttu-id="8412d-363">Ce point est important, car plus la **caméra principale** est éloignée de 0, 0, moins la précision d’une rotation autour de la poupée deviendra du point de vue de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8412d-363">This is important as the farther the **main camera** is away from 0,0,0, the less accurate a rotation around the dolly would become from the point of view of the user.</span></span> <span data-ttu-id="8412d-364">En fait, si vous ne faites pas pivoter la position de la caméra, l’utilisateur se déplacera sur un arc autour du **chariot** plutôt que sur la rotation.</span><span class="sxs-lookup"><span data-stu-id="8412d-364">In fact, if you do not rotate around the camera position, the user will move on an arc around the **dolly** rather than rotating.</span></span>

<span data-ttu-id="8412d-365">La deuxième tâche pour MixedRealityTeleport consiste à gérer le déplacement de la **poupée**.</span><span class="sxs-lookup"><span data-stu-id="8412d-365">The second job for MixedRealityTeleport is to handle moving the **dolly**.</span></span> <span data-ttu-id="8412d-366">Cette opération s’effectue dans SetWorldPosition.</span><span class="sxs-lookup"><span data-stu-id="8412d-366">This is done in SetWorldPosition.</span></span> <span data-ttu-id="8412d-367">SetWorldPosition prend la position universelle souhaitée, c’est-à-dire la position à laquelle l’utilisateur veut percieve qu’il habite.</span><span class="sxs-lookup"><span data-stu-id="8412d-367">SetWorldPosition takes the desired world position, the position where the user wants to percieve that they inhabit.</span></span> <span data-ttu-id="8412d-368">Nous devons placer notre **poupée** à cette position, moins la position locale de la **caméra principale**, car ce décalage sera ajouté à chaque cadre.</span><span class="sxs-lookup"><span data-stu-id="8412d-368">We need to put our **dolly** at that position minus the local position of the **main camera**, as that offset will be added each frame.</span></span>

<span data-ttu-id="8412d-369">Un deuxième script appelle SetWorldPosition.</span><span class="sxs-lookup"><span data-stu-id="8412d-369">A second script calls SetWorldPosition.</span></span> <span data-ttu-id="8412d-370">Examinons ce script.</span><span class="sxs-lookup"><span data-stu-id="8412d-370">Let's look at that script.</span></span> <span data-ttu-id="8412d-371">Dans le panneau projet, accédez à **Assets\AppPrefabs\Support\Scripts\GameLogic** et double-cliquez sur **TeleportScript.cs**.</span><span class="sxs-lookup"><span data-stu-id="8412d-371">In the project panel, navigate to **Assets\AppPrefabs\Support\Scripts\GameLogic** and double-click on **TeleportScript.cs**.</span></span>

<span data-ttu-id="8412d-372">Ce script est un peu plus impliqué dans MixedRealityTeleport.</span><span class="sxs-lookup"><span data-stu-id="8412d-372">This script is a little more involved than MixedRealityTeleport.</span></span> <span data-ttu-id="8412d-373">Le script vérifie que le bouton Y du contrôleur Xbox est maintenu enfoncé.</span><span class="sxs-lookup"><span data-stu-id="8412d-373">The script is checking for the Y Button on the Xbox controller to be held down.</span></span> <span data-ttu-id="8412d-374">Lorsque le bouton est maintenu enfoncé, un curseur de téléverrouillage est rendu et le script convertit un rayon à partir de la position de regard de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8412d-374">While the button is held down a teleport cursor is rendered and the script casts a ray from the user's gaze position.</span></span> <span data-ttu-id="8412d-375">Si ce rayon entre en conflit avec une surface qui est plus ou moins pointée vers le haut, la surface sera considérée comme une bonne surface de téléchargement et l’animation sur le curseur de télétentative sera activée.</span><span class="sxs-lookup"><span data-stu-id="8412d-375">If that ray collides with a surface that is more or less pointing up, the surface will be considered a good surface to teleport to, and the animation on the teleport cursor will be enabled.</span></span> <span data-ttu-id="8412d-376">Si le rayon n’entre pas en conflit avec une surface qui pointe vers le haut, l’animation sur le curseur est désactivée.</span><span class="sxs-lookup"><span data-stu-id="8412d-376">If the ray does not collide with a surface more or less pointing up, then the animation on the cursor will be disabled.</span></span> <span data-ttu-id="8412d-377">Lorsque le bouton Y est relâché et que le point calculé du rayon est une position valide, le script appelle SetWorldPosition avec la position de l’intersection entre le rayon et le rayon.</span><span class="sxs-lookup"><span data-stu-id="8412d-377">When the Y button is released and the calculated point of the ray is a valid position, the script calls SetWorldPosition with the position the ray intersected.</span></span>

### <a name="enjoy-your-progress"></a><span data-ttu-id="8412d-378">Profitez de votre progression</span><span class="sxs-lookup"><span data-stu-id="8412d-378">Enjoy your progress</span></span>

<span data-ttu-id="8412d-379">Cette fois, vous devez rechercher un ami.</span><span class="sxs-lookup"><span data-stu-id="8412d-379">This time you'll need to find a friend.</span></span>

<span data-ttu-id="8412d-380">Une fois encore, un utilisateur avec HoloLens hébergera une session.</span><span class="sxs-lookup"><span data-stu-id="8412d-380">Once again, a user with the HoloLens will host a session.</span></span> <span data-ttu-id="8412d-381">D’autres utilisateurs vont rejoindre la session.</span><span class="sxs-lookup"><span data-stu-id="8412d-381">Other users will join the session.</span></span> <span data-ttu-id="8412d-382">L’application place les trois premiers utilisateurs à joindre à partir d’un casque immersif sur l’un des trois tracés sur l’îlot.</span><span class="sxs-lookup"><span data-stu-id="8412d-382">The application will place the first three users to join from an immersive headset on one of the three paths on the island.</span></span> <span data-ttu-id="8412d-383">N’hésitez pas à explorer l’île dans cette section.</span><span class="sxs-lookup"><span data-stu-id="8412d-383">Feel free to explore the island in this section.</span></span>

<span data-ttu-id="8412d-384">Détails à noter:</span><span class="sxs-lookup"><span data-stu-id="8412d-384">Details to notice:</span></span>
1. <span data-ttu-id="8412d-385">Vous pouvez voir les visages dans les Clouds, ce qui permet à un utilisateur immersif de voir la direction qu’un utilisateur HoloLens recherche.</span><span class="sxs-lookup"><span data-stu-id="8412d-385">You can see faces in the clouds, which helps an immersed user see which direction a HoloLens user is looking.</span></span>
2. <span data-ttu-id="8412d-386">Les avatars sur l’îlot ont des cou qui pivotent.</span><span class="sxs-lookup"><span data-stu-id="8412d-386">The avatars on the island have necks that rotate.</span></span> <span data-ttu-id="8412d-387">Ils ne suivent pas ce que fait l’utilisateur en réalité (nous n’avons pas ces informations), mais il offre une expérience intéressante.</span><span class="sxs-lookup"><span data-stu-id="8412d-387">They won't follow what the user is doing is real reality (we don't have that information) but it makes for a nice experience.</span></span>
3. <span data-ttu-id="8412d-388">Si l’utilisateur HoloLens examine l’île, les utilisateurs immergés peuvent voir leur curseur.</span><span class="sxs-lookup"><span data-stu-id="8412d-388">If the HoloLens user is looking at the Island, the immersed users can see their cursor.</span></span>
4. <span data-ttu-id="8412d-389">Les clouds qui représentent les utilisateurs HoloLens convertient des ombres.</span><span class="sxs-lookup"><span data-stu-id="8412d-389">The clouds that represent the HoloLens users cast shadows.</span></span>

## <a name="chapter-5---finale"></a><span data-ttu-id="8412d-390">Chapitre 5-finalisation</span><span class="sxs-lookup"><span data-stu-id="8412d-390">Chapter 5 - Finale</span></span>

>[!VIDEO https://www.youtube.com/embed/n_HDWJbfpNg]

### <a name="objectives"></a><span data-ttu-id="8412d-391">Objectifs</span><span class="sxs-lookup"><span data-stu-id="8412d-391">Objectives</span></span>

<span data-ttu-id="8412d-392">Créez une expérience interactive collaborative entre les deux types d’appareils.</span><span class="sxs-lookup"><span data-stu-id="8412d-392">Create a collaborative interactive experience between the two device types.</span></span>

### <a name="what-we-will-build"></a><span data-ttu-id="8412d-393">Ce que nous allons créer</span><span class="sxs-lookup"><span data-stu-id="8412d-393">What we will build</span></span>

<span data-ttu-id="8412d-394">En s’appuyant sur le chapitre 4, lorsqu’un utilisateur avec un casque immersif est proche d’un puzzle sur l’île, les utilisateurs de HoloLens reçoivent une info-bulle avec un indice sur le puzzle.</span><span class="sxs-lookup"><span data-stu-id="8412d-394">Building on chapter 4, when a user with an immersive headset gets near a puzzle on the island, the HoloLens users will get a tool tip with a clue to the puzzle.</span></span> <span data-ttu-id="8412d-395">Une fois que tous les utilisateurs du casque immersif ont passé leurs puzzles et dans le panneau «Ready» dans la salle de fusée, le fusée démarre.</span><span class="sxs-lookup"><span data-stu-id="8412d-395">Once all of the immersive headset users get past their puzzles and onto the "ready pad" in the rocket room, the rocket will launch.</span></span>

### <a name="steps"></a><span data-ttu-id="8412d-396">Étapes</span><span class="sxs-lookup"><span data-stu-id="8412d-396">Steps</span></span>
* <span data-ttu-id="8412d-397">Dans **hiérarchie**, sélectionnez **Usland**.</span><span class="sxs-lookup"><span data-stu-id="8412d-397">In **Hierarchy**, select **Usland**.</span></span>
* <span data-ttu-id="8412d-398">Dans l' **inspecteur**, dans **contrôle de niveau**, activez la case à cocher Activer la **collaboration**.</span><span class="sxs-lookup"><span data-stu-id="8412d-398">In **Inspector**, in **Level Control**, check **Enable Collaboration**.</span></span>

### <a name="digging-into-the-code"></a><span data-ttu-id="8412d-399">Examen du code</span><span class="sxs-lookup"><span data-stu-id="8412d-399">Digging into the code</span></span>

<span data-ttu-id="8412d-400">Nous allons maintenant examiner LevelControl.cs.</span><span class="sxs-lookup"><span data-stu-id="8412d-400">Now let us look at LevelControl.cs.</span></span> <span data-ttu-id="8412d-401">Ce script est le cœur de la logique de jeu et gère l’état du jeu.</span><span class="sxs-lookup"><span data-stu-id="8412d-401">This script is the core of the game logic and maintains the game state.</span></span> <span data-ttu-id="8412d-402">Dans la mesure où il s’agit d’un jeu multijoueur utilisant UNET, nous devons comprendre la façon dont les données circulent, au moins suffisamment bien pour modifier ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="8412d-402">Since this is a multiplayer game using UNET we need to understand how data flows, at least well enough to modify this tutorial.</span></span> <span data-ttu-id="8412d-403">Pour une vue d’ensemble plus complète de UNET, reportez-vous à la documentation d’Unity.</span><span class="sxs-lookup"><span data-stu-id="8412d-403">For a more complete overview of UNET, please refer to Unity's documentation.</span></span>

<span data-ttu-id="8412d-404">Dans le panneau projet, accédez à **Assets\AppPrefabs\Support\Scripts\GameLogic** et double-cliquez sur **LevelControl.cs**.</span><span class="sxs-lookup"><span data-stu-id="8412d-404">In the project panel, navigate to **Assets\AppPrefabs\Support\Scripts\GameLogic** and double-click on **LevelControl.cs**.</span></span>

<span data-ttu-id="8412d-405">Voyons comment un casque immersif indique qu’ils sont prêts pour le lancement de fusée.</span><span class="sxs-lookup"><span data-stu-id="8412d-405">Let us understand how an immersive headset indicates that they are ready for the rocket launch.</span></span> <span data-ttu-id="8412d-406">La préparation au lancement de fusée est communiquée par la définition de l’un des trois bools dans une liste de bools qui correspondent aux trois tracés sur l’îlot.</span><span class="sxs-lookup"><span data-stu-id="8412d-406">Rocket Launch readiness is communicated by setting one of three bools in a list of bools that correspond to the three paths on the island.</span></span> <span data-ttu-id="8412d-407">La valeur booléenne d’un chemin d’accès est définie lorsque l’utilisateur affecté au chemin d’accès se trouve au-dessus du pavé brun dans la salle de fusée.</span><span class="sxs-lookup"><span data-stu-id="8412d-407">A path's bool will be set when the user assigned to the path is on top of the brown pad inside the rocket room.</span></span> <span data-ttu-id="8412d-408">OK, maintenant aux détails.</span><span class="sxs-lookup"><span data-stu-id="8412d-408">Okay, now to the details.</span></span>

<span data-ttu-id="8412d-409">Nous allons commencer par la fonction Update ().</span><span class="sxs-lookup"><span data-stu-id="8412d-409">We will start in the Update() function.</span></span> <span data-ttu-id="8412d-410">Vous noterez qu’il y a une fonction «triche».</span><span class="sxs-lookup"><span data-stu-id="8412d-410">You will note that there is a 'cheat' function.</span></span> <span data-ttu-id="8412d-411">Nous l’avons utilisé en développement pour tester l’ordre de lancement et de réinitialisation des fusées.</span><span class="sxs-lookup"><span data-stu-id="8412d-411">We used this in development to test the rocket launch and reset sequence.</span></span> <span data-ttu-id="8412d-412">Elle ne fonctionnera pas dans l’expérience multi-utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8412d-412">It won't work in the multi user experience.</span></span> <span data-ttu-id="8412d-413">J’espère que lorsque vous internalrez l’inversion suivante, vous pouvez le faire fonctionner.</span><span class="sxs-lookup"><span data-stu-id="8412d-413">Hopefully by the time you internalize the following infromation you can make it work.</span></span> <span data-ttu-id="8412d-414">Une fois que nous avons vérifié que nous devrions faire une triche, nous vérifions si le joueur local est plongé.</span><span class="sxs-lookup"><span data-stu-id="8412d-414">After we check to see if we should cheat, we check to see if the local player is immersed.</span></span> <span data-ttu-id="8412d-415">Nous souhaitons nous concentrer sur la façon dont nous sommes à l’objectif.</span><span class="sxs-lookup"><span data-stu-id="8412d-415">We want to focus on how we find that we're at the goal.</span></span> <span data-ttu-id="8412d-416">À l’intérieur de la vérification if (immergée), un appel à CheckGoal est masqué derrière le **EnableCollaboration** bool.</span><span class="sxs-lookup"><span data-stu-id="8412d-416">Inside of the if (Immersed) check, there is a call to CheckGoal hiding behind the **EnableCollaboration** bool.</span></span> <span data-ttu-id="8412d-417">Cela correspond à la case à cocher que vous avez sélectionnée lors de l’exécution des étapes de ce chapitre.</span><span class="sxs-lookup"><span data-stu-id="8412d-417">This corresponds to the checkbox you checked while completing the steps for this chapter.</span></span> <span data-ttu-id="8412d-418">Dans EnableCollaboration, nous voyons un appel à CheckGoal ().</span><span class="sxs-lookup"><span data-stu-id="8412d-418">Inside of EnableCollaboration we see a call to CheckGoal().</span></span>

<span data-ttu-id="8412d-419">CheckGoal effectue certaines opérations mathématiques pour voir si nous sommes plus ou moins debout sur le boîtier.</span><span class="sxs-lookup"><span data-stu-id="8412d-419">CheckGoal does some math to see if we are more or less standing on the pad.</span></span> <span data-ttu-id="8412d-420">Dans ce cas, nous déboguons. log «arrivé à l’objectif», puis nous appelons «SendAtGoalMessage ()».</span><span class="sxs-lookup"><span data-stu-id="8412d-420">When we are, we Debug.Log "Arrived at goal" and then we call 'SendAtGoalMessage()'.</span></span> <span data-ttu-id="8412d-421">Dans SendAtGoalMessage, nous appelons playerController. SendAtGoal.</span><span class="sxs-lookup"><span data-stu-id="8412d-421">In SendAtGoalMessage we call playerController.SendAtGoal.</span></span> <span data-ttu-id="8412d-422">Pour gagner du temps, voici le code:</span><span class="sxs-lookup"><span data-stu-id="8412d-422">To save you some time, here's the code:</span></span>

```cs
private void CmdSendAtGoal(int GoalIndex)
       {
           levelState.SetGoalIndex(GoalIndex);
       }
```

```cs
public void SendAtGoal(int GoalIndex)
       {
           if (isLocalPlayer)
           {
               Debug.Log("sending at goal " + GoalIndex);
               CmdSendAtGoal(GoalIndex);
           }
       }
```

<span data-ttu-id="8412d-423">Notez que SendAtGoalMessage appelle CmdSendAtGoal, qui appelle levelState. SetGoalIndex, qui est de nouveau dans LevelControl.cs.</span><span class="sxs-lookup"><span data-stu-id="8412d-423">Note that SendAtGoalMessage calls CmdSendAtGoal, which calls levelState.SetGoalIndex, which is back in LevelControl.cs.</span></span> <span data-ttu-id="8412d-424">À première vue, cela semble étrange.</span><span class="sxs-lookup"><span data-stu-id="8412d-424">At first glance this seems strange.</span></span> <span data-ttu-id="8412d-425">Pourquoi ne pas simplement appeler SetGoalIndex au lieu d’effectuer un routage dans le contrôleur de lecteur?</span><span class="sxs-lookup"><span data-stu-id="8412d-425">Why not just call SetGoalIndex rather than this strange routing through the player controller?</span></span> <span data-ttu-id="8412d-426">Cela est dû au fait que nous nous conformons au modèle de données utilisé par UNET pour maintenir la synchronisation des données. Pour empêcher la triche et le blocage, UNET nécessite que chaque objet dispose d’un utilisateur habilité à modifier les variables synchronisées.</span><span class="sxs-lookup"><span data-stu-id="8412d-426">The reason is that we are conforming to the data model UNET uses to keep data in sync. To prevent cheating and thrashing, UNET requires that each object has a user who has authority to change the synchronized variables.</span></span> <span data-ttu-id="8412d-427">En outre, seul l’hôte (l’utilisateur qui a démarré la session) peut modifier directement les données.</span><span class="sxs-lookup"><span data-stu-id="8412d-427">Further, only the host (the user that started the session) can change data directly.</span></span> <span data-ttu-id="8412d-428">Les utilisateurs qui ne sont pas l’hôte, mais qui ont une autorité, doivent envoyer une «commande» à l’hôte qui modifiera la variable.</span><span class="sxs-lookup"><span data-stu-id="8412d-428">Users who are not the host, but have authority, need to send a 'command' to the host which will change the variable.</span></span> <span data-ttu-id="8412d-429">Par défaut, l’hôte a autorité sur tous les objets, à l’exception de l’objet généré pour représenter l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8412d-429">By default the host has authority over all objects, except for the object spawned to represent the user.</span></span> <span data-ttu-id="8412d-430">Dans notre cas, cet objet contient le script playercontroller.</span><span class="sxs-lookup"><span data-stu-id="8412d-430">In our case this object has the playercontroller script.</span></span> <span data-ttu-id="8412d-431">Il existe un moyen de demander une autorité pour un objet, puis d’apporter des modifications, mais nous choisissons de tirer parti du fait que le contrôleur de lecteur dispose d’une autorité autonome et de commandes de routage via le contrôleur de lecteur.</span><span class="sxs-lookup"><span data-stu-id="8412d-431">There is a way to request authority for an object and then make changes, but we choose to leverage the fact that the player controller has self authority and route commands through the player controller.</span></span>

<span data-ttu-id="8412d-432">Autrement dit, lorsque nous nous sommes trouvés dans notre objectif, le joueur doit indiquer à l’hôte, et l’hôte va dire à tous les autres utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="8412d-432">Said another way, when we've found ourselves at our goal, the player needs to tell the host, and the host will tell everyone else.</span></span>

<span data-ttu-id="8412d-433">De retour dans LevelControl.cs, consultez SetGoalIndex.</span><span class="sxs-lookup"><span data-stu-id="8412d-433">Back in LevelControl.cs look at SetGoalIndex.</span></span> <span data-ttu-id="8412d-434">Ici, nous définissons la valeur d’une valeur dans un SyncList (AtGoal).</span><span class="sxs-lookup"><span data-stu-id="8412d-434">Here we are setting the value of a value in a synclist (AtGoal).</span></span> <span data-ttu-id="8412d-435">N’oubliez pas que nous sommes dans le contexte de l’hôte pendant que nous faisons cela.</span><span class="sxs-lookup"><span data-stu-id="8412d-435">Remember that we are in the context of the host while we do this.</span></span> <span data-ttu-id="8412d-436">À l’instar d’une commande, un RPC est un problème que l’hôte peut émettre et qui entraînent l’exécution de code par tous les clients.</span><span class="sxs-lookup"><span data-stu-id="8412d-436">Similar to a command, an RPC is something the host can issue that will cause all clients to run some code.</span></span> <span data-ttu-id="8412d-437">Ici, nous appelons «RpcCheckAllGoals».</span><span class="sxs-lookup"><span data-stu-id="8412d-437">Here we call 'RpcCheckAllGoals'.</span></span> <span data-ttu-id="8412d-438">Chaque client vérifie individuellement si les trois AtGoals sont définis et, le cas échéant, lance la fusée.</span><span class="sxs-lookup"><span data-stu-id="8412d-438">Each client will individually check to see if all three AtGoals are set, and if so, launch the rocket.</span></span>

### <a name="enjoy-your-progress"></a><span data-ttu-id="8412d-439">Profitez de votre progression</span><span class="sxs-lookup"><span data-stu-id="8412d-439">Enjoy your progress</span></span>

<span data-ttu-id="8412d-440">En s’appuyant sur le chapitre précédent, nous allons démarrer la session comme auparavant.</span><span class="sxs-lookup"><span data-stu-id="8412d-440">Building on the previous chapter, we will start the session as before.</span></span> <span data-ttu-id="8412d-441">Cette fois, lorsque les utilisateurs du casque immersif obtiennent la «porte» sur leur chemin d’accès, une info-bulle s’affiche pour que seuls les utilisateurs HoloLens puissent voir.</span><span class="sxs-lookup"><span data-stu-id="8412d-441">This time as the users in the immersive headset get to the "door" on their path, a tooltip will appear that only the HoloLens users can see.</span></span> <span data-ttu-id="8412d-442">Les utilisateurs de HoloLens sont responsables de la communication de cet indice aux utilisateurs du casque immersif.</span><span class="sxs-lookup"><span data-stu-id="8412d-442">The HoloLens users are responsible for communicating this clue to the users in the immersive headset.</span></span> <span data-ttu-id="8412d-443">La fusée démarre sur espace une fois que chaque avatar a effectué un pas à pas sur son panneau brun correspondant à l’intérieur des Volcano.</span><span class="sxs-lookup"><span data-stu-id="8412d-443">The rocket will launch to space once each avatar has stepped on its corresponding brown pad inside the volcano.</span></span> <span data-ttu-id="8412d-444">La scène sera réinitialisée après 60 secondes pour vous permettre de le faire à nouveau.</span><span class="sxs-lookup"><span data-stu-id="8412d-444">The scene will reset after 60 seconds so you can do it again.</span></span>

## <a name="see-also"></a><span data-ttu-id="8412d-445">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="8412d-445">See also</span></span>
* [<span data-ttu-id="8412d-446">Réalité mixte - Entrées - Cours 213 : Contrôleurs de mouvement</span><span class="sxs-lookup"><span data-stu-id="8412d-446">MR Input 213: Motion controllers</span></span>](mixed-reality-213.md)
